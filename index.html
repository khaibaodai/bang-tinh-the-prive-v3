<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công cụ tính dòng tiền The Privé - Phiên bản 3.0</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1, h2, h3, h4 {
            color: #2c5282;
        }
        
        .section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        table, th, td {
            border: 1px solid #e2e8f0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: #edf2f7;
        }
        
        .floor-plan-img {
            max-width: 100%;
            height: auto;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }
        
        .layout-img {
            max-width: 100%;
            height: auto;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }
        
        input[type="text"], 
        input[type="number"], 
        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-size: 16px;
        }
        
        input[type="checkbox"],
        input[type="radio"] {
            margin-right: 8px;
        }
        
        .btn {
            padding: 10px 16px;
            background-color: #4299e1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
        }
        
        .btn:hover {
            background-color: #3182ce;
        }
        
        .tab {
            display: none;
        }
        
        .tab.active {
            display: block;
        }
        
        .price {
            font-weight: bold;
            color: #2d3748;
        }
        
        .highlight {
            background-color: #ebf8ff;
            padding: 2px 4px;
            border-radius: 4px;
        }
        
        .warning {
            color: #c53030;
            font-weight: 500;
        }
        
        .success {
            color: #2f855a;
            font-weight: 500;
        }
        
        .comparison-table th {
            background-color: #4299e1;
            color: white;
        }
        
        .comparison-table tr:nth-child(even) {
            background-color: #f7fafc;
        }
        
        .advantage {
            color: #2f855a;
        }
        
        .disadvantage {
            color: #c53030;
        }
        
        .header-logo {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background-color: #e2e8f0;
            border: none;
            border-radius: 4px 4px 0 0;
            margin-right: 4px;
            cursor: pointer;
        }
        
        .tab-btn.active {
            background-color: #4299e1;
            color: white;
        }
        
        .recommendation {
            background-color: #ebf8ff;
            border-left: 4px solid #4299e1;
            padding: 16px;
            margin-top: 20px;
        }
        
        @media print {
            body {
                background-color: white;
            }
            
            .section {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #e2e8f0;
            }
            
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-logo">
            <div>
                <h1 class="text-3xl font-bold mb-1">CÔNG CỤ TÍNH DÒNG TIỀN THE PRIVÉ</h1>
                <h2 class="text-xl">Đại lý chiến lược OneS</h2>
                <h3 class="text-lg font-bold text-blue-600">HOTLINE: 090 398 3737</h3>
            </div>
        </div>
        
        <!-- MẶT BẰNG TỔNG -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">MẶT BẰNG TỔNG</h2>
            <div class="mb-4">
                <img id="mat_bang_tong" src="https://lh3.googleusercontent.com/d/1dmKiMsmvS5YTtj5pZ7bSWfE8FGta_EHD" alt="Mặt bằng tổng The Privé" class="floor-plan-img">
            </div>
        </div>
        
        <!-- MẶT BẰNG TẦNG ĐIỂN HÌNH -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">MẶT BẰNG TẦNG ĐIỂN HÌNH</h2>
            <div class="mb-4">
                <img id="mat_bang_tang" src="https://i.postimg.cc/52vKWZXz/MB-TANG-DIEN-HINH-THAP-5-6-7.png" alt="Mặt bằng tầng điển hình" class="floor-plan-img">
            </div>
            <p class="mb-4">Chọn tháp và tầng để xem mặt bằng tầng tương ứng</p>
        </div>
        
        <!-- THÔNG TIN CĂN HỘ -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">THÔNG TIN CĂN HỘ</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label for="tower" class="block mb-2 font-medium">Tháp:</label>
                    <select id="tower" class="w-full p-2 border rounded">
                        <option value="">Chọn tháp</option>
                        <option value="5">Tháp 5</option>
                        <option value="6">Tháp 6</option>
                        <option value="7">Tháp 7</option>
                        <option value="8">Tháp 8</option>
                    </select>
                </div>
                <div>
                    <label for="apartment_code" class="block mb-2 font-medium">Mã căn hộ:</label>
                    <select id="apartment_code" class="w-full p-2 border rounded" disabled>
                        <option value="">Chọn mã căn hộ</option>
                    </select>
                </div>
                <div>
                    <label for="floor" class="block mb-2 font-medium">Tầng:</label>
                    <select id="floor" class="w-full p-2 border rounded" disabled>
                        <option value="">Chọn tầng</option>
                    </select>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <div class="mb-4">
                        <label for="ma_can_ho" class="block mb-2 font-medium">Mã căn hộ đầy đủ:</label>
                        <input type="text" id="ma_can_ho" class="w-full p-2 border rounded" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="gia_m2" class="block mb-2 font-medium">Đơn giá (VNĐ/m²):</label>
                        <input type="number" id="gia_m2" class="w-full p-2 border rounded" value="99000000">
                    </div>
                    <div class="mb-4">
                        <label for="dien_tich_tim_tuong" class="block mb-2 font-medium">Diện tích tim tường (m²):</label>
                        <input type="number" id="dien_tich_tim_tuong" class="w-full p-2 border rounded" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="dien_tich_thong_thuy" class="block mb-2 font-medium">Diện tích thông thủy (m²):</label>
                        <input type="number" id="dien_tich_thong_thuy" class="w-full p-2 border rounded" readonly>
                    </div>
                </div>
                <div>
                    <div class="mb-4">
                        <label for="huong_can" class="block mb-2 font-medium">Hướng căn hộ:</label>
                        <input type="text" id="huong_can" class="w-full p-2 border rounded" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="view_can" class="block mb-2 font-medium">View căn hộ:</label>
                        <input type="text" id="view_can" class="w-full p-2 border rounded" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="loai_can_ho" class="block mb-2 font-medium">Loại căn hộ:</label>
                        <input type="text" id="loai_can_ho" class="w-full p-2 border rounded" readonly>
                    </div>
                </div>
            </div>
            
            <div id="apartment_layout" class="mt-4">
                <h3 class="text-xl font-bold mb-2">Mặt bằng căn hộ</h3>
                <img id="layout_image" src="" alt="Layout căn hộ" class="layout-img hidden">
            </div>
        </div>
        
        <!-- CÀI ĐẶT THUẾ & PHÍ -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">CÀI ĐẶT THUẾ & PHÍ</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="vat_percent" class="block mb-2 font-medium">Thuế VAT (%):</label>
                    <input type="number" id="vat_percent" class="w-full p-2 border rounded" value="10">
                </div>
                <div>
                    <label for="phi_bao_tri_percent" class="block mb-2 font-medium">Phí bảo trì (%):</label>
                    <input type="number" id="phi_bao_tri_percent" class="w-full p-2 border rounded" value="2">
                </div>
            </div>
        </div>
        
        <!-- CHÍNH SÁCH ƯU ĐÃI -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">CHÍNH SÁCH ƯU ĐÃI</h2>
            
            <!-- 1. Chiết khấu Đăng ký nguyện vọng -->
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2">1. Chiết khấu Đăng ký nguyện vọng (3%)</h3>
                <div class="mb-2">
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="chiet_khau_nguyen_vong" class="form-checkbox">
                        <span class="ml-2">Khách hàng có Đăng ký nguyện vọng giao dịch sản phẩm được ĐVKD xác nhận trước 15/06/2025?</span>
                    </label>
                </div>
            </div>
            
            <!-- 2. Chiết khấu Ưu đãi đặc biệt -->
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2">2. Chiết khấu Ưu đãi đặc biệt (Tối đa 2%)</h3>
                <div class="mb-2">
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="chiet_khau_dac_biet_1" class="form-checkbox chiet_khau_dac_biet">
                        <span class="ml-2">Khách hàng là KH đã/đang giao dịch sản phẩm do DXG làm CĐT/Nhà phát triển?</span>
                    </label>
                </div>
                <div class="mb-2">
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="chiet_khau_dac_biet_2" class="form-checkbox chiet_khau_dac_biet">
                        <span class="ml-2">Khách hàng là Cổ đông sở hữu cổ phiếu DXG/DXS từ 10,000 CP trước ngày công bố dự án?</span>
                    </label>
                </div>
                <div class="mb-2">
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="chiet_khau_dac_biet_3" class="form-checkbox chiet_khau_dac_biet">
                        <span class="ml-2">Khách hàng là CBNV ngân hàng tài trợ HOẶC có sổ tiết kiệm/TK ≥ 1 tỷ tại NH tài trợ?</span>
                    </label>
                </div>
                <p class="text-sm text-gray-600 mt-2">Lưu ý: Nếu khách hàng đáp ứng nhiều tiêu chuẩn thì vẫn chỉ áp dụng 1 mức chiết khấu là 2%</p>
            </div>
            
            <!-- 3. Chiết khấu Giao dịch nhiều sản phẩm -->
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2">3. Chiết khấu Giao dịch nhiều sản phẩm</h3>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="chiet_khau_mua_nhieu" id="chiet_khau_mua_nhieu_0" value="0" checked class="form-radio">
                        <span class="ml-2">1 sản phẩm</span>
                    </label>
                </div>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="chiet_khau_mua_nhieu" id="chiet_khau_mua_nhieu_1" value="1" class="form-radio">
                        <span class="ml-2">2 sản phẩm</span>
                    </label>
                </div>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="chiet_khau_mua_nhieu" id="chiet_khau_mua_nhieu_2" value="1.5" class="form-radio">
                        <span class="ml-2">Từ 3 sản phẩm trở lên</span>
                    </label>
                </div>
            </div>

            <!-- 4. Voucher Chiết Khấu -->
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2">4. Voucher Chiết Khấu</h3>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="voucher_chiet_khau" id="voucher_chiet_khau_0" value="0" checked class="form-radio">
                        <span class="ml-2">Không áp dụng voucher</span>
                    </label>
                </div>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="voucher_chiet_khau" id="voucher_chiet_khau_20" value="20" class="form-radio">
                        <span class="ml-2">Voucher 20% - Khách hàng đình danh gốc (5% ký HĐMB, 10% bàn giao, 5% nhận GCN)</span>
                    </label>
                </div>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="voucher_chiet_khau" id="voucher_chiet_khau_18" value="18" class="form-radio">
                        <span class="ml-2">Voucher 18% - Khách hàng nhận chuyển giao (5% ký HĐMB, 8% bàn giao, 5% nhận GCN)</span>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- TÍNH TOÁN GIÁ TRỊ CĂN HỘ -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">TÍNH TOÁN GIÁ TRỊ CĂN HỘ</h2>
            <button id="calculate_btn" class="btn mb-4">Tính toán</button>
            
            <table class="w-full mb-6">
                <tbody>
                    <tr>
                        <td>Tổng giá bán căn hộ (chưa VAT, chưa phí bảo trì):</td>
                        <td id="gia_ban_can_ho_truoc_vat" class="price">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Thuế VAT (<span id="vat_percent_display">10</span>%):</td>
                        <td id="vat_amount" class="price">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Tổng giá bán căn hộ (bao gồm VAT):</td>
                        <td id="tong_gia_ban_can_ho_gom_vat_ban_dau" class="price">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Phí bảo trì (<span id="phi_bao_tri_percent_display">2</span>% trên giá chưa VAT):</td>
                        <td id="phi_bao_tri_amount" class="price">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Tổng chiết khấu chung (<span id="tong_phan_tram_chiet_khau_chung">0</span>%):</td>
                        <td id="tong_tien_chiet_khau_chung" class="price">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Giá bán cuối cùng (bao gồm VAT, sau chiết khấu chung):</td>
                        <td id="gia_ban_cuoi_cung_gom_vat_sau_ck_chung" class="price highlight">0 VNĐ</td>
                    </tr>
                    <tr id="voucher_chiet_khau_row" class="hidden">
                        <td>Voucher chiết khấu (<span id="voucher_percent_display">0</span>%):</td>
                        <td id="voucher_amount" class="price highlight">0 VNĐ</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- THÔNG TIN TÀI CHÍNH KHÁCH HÀNG -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">THÔNG TIN TÀI CHÍNH KHÁCH HÀNG</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="von_tu_co" class="block mb-2 font-medium">Vốn tự có của khách hàng (VNĐ):</label>
                    <input type="number" id="von_tu_co" class="w-full p-2 border rounded" value="1500000000">
                </div>
                <div>
                    <label for="thu_nhap_hang_thang" class="block mb-2 font-medium">Thu nhập hàng tháng của khách hàng (VNĐ):</label>
                    <input type="number" id="thu_nhap_hang_thang" class="w-full p-2 border rounded" value="80000000">
                </div>
            </div>
        </div>
        
        <!-- PHƯƠNG THỨC THANH TOÁN -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">PHƯƠNG THỨC THANH TOÁN</h2>
            
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="openTab('pttt_chuan')">PTTT Chuẩn (26 tháng)</button>
                <button class="tab-btn" onclick="openTab('pttt_nhanh')">PTTT Nhanh - Ưu đãi "Cực khủng"</button>
                <button class="tab-btn" onclick="openTab('pttt_vay')">PTTT Hỗ trợ vay ưu đãi (Nhận nhà chỉ với 8.6%)</button>
            </div>
            
            <!-- PTTT CHUẨN -->
            <div id="pttt_chuan" class="tab active">
                <h3 class="text-xl font-bold mb-4">PHƯƠNG THỨC THANH TOÁN CHUẨN (26 THÁNG)</h3>
                <table class="w-full">
                    <thead>
                        <tr>
                            <th>Đợt thanh toán</th>
                            <th>Tỷ lệ (%)</th>
                            <th>Số tiền (VNĐ)</th>
                            <th>Tiến độ / Thời gian</th>
                            <th>Thời gian</th>
                        </tr>
                    </thead>
                    <tbody id="pttt_chuan_table">
                        <!-- JS sẽ điền bảng này -->
                    </tbody>
                </table>
            </div>
            
            <!-- PTTT NHANH -->
            <div id="pttt_nhanh" class="tab">
                <h3 class="text-xl font-bold mb-4">PHƯƠNG THỨC THANH TOÁN NHANH – ƯU ĐÃI "CỰC KHỦNG"</h3>
                <table class="w-full">
                    <thead>
                        <tr>
                            <th>Đợt thanh toán</th>
                            <th>Tỷ lệ (%)</th>
                            <th>Số tiền (VNĐ)</th>
                            <th>Tiến độ / Thời gian</th>
                            <th>Thời gian</th>
                        </tr>
                    </thead>
                    <tbody id="pttt_nhanh_table">
                        <!-- JS sẽ điền bảng này -->
                    </tbody>
                </table>
                
                <div class="mt-4 p-4 bg-blue-100 rounded">
                    <p class="font-medium">Ưu đãi đặc biệt: Chiết khấu 8% cho khoản thanh toán 60% giá trị căn hộ</p>
                    <p>Tổng số tiền được chiết khấu: <span id="chiet_khau_thanh_toan_nhanh_amount" class="font-bold">0 VNĐ</span></p>
                </div>
            </div>
            
            <!-- PTTT VAY -->
            <div id="pttt_vay" class="tab">
                <h3 class="text-xl font-bold mb-4">PHƯƠNG THỨC HỖ TRỢ VAY ƯU ĐÃI – NHẬN NHÀ CHỈ VỚI 8,6%</h3>
                
                <div class="mb-6">
                    <h4 class="text-lg font-bold mb-2">Thông tin khoản vay</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="lai_suat_vay_uu_dai_nam" class="block mb-2 font-medium">Lãi suất vay ưu đãi (%/năm):</label>
                            <input type="number" id="lai_suat_vay_uu_dai_nam" class="w-full p-2 border rounded" value="0">
                        </div>
                        <div>
                            <label for="thoi_gian_vay_nam" class="block mb-2 font-medium">Thời gian vay (năm):</label>
                            <input type="number" id="thoi_gian_vay_nam" class="w-full p-2 border rounded" value="30">
                        </div>
                        <div>
                            <label for="thoi_gian_ho_tro_lai_suat_thang" class="block mb-2 font-medium">Thời gian hỗ trợ lãi suất (tháng):</label>
                            <input type="number" id="thoi_gian_ho_tro_lai_suat_thang" class="w-full p-2 border rounded" value="24">
                        </div>
                        <div>
                            <label for="thoi_gian_an_han_goc_thang" class="block mb-2 font-medium">Thời gian ân hạn nợ gốc (tháng):</label>
                            <input type="number" id="thoi_gian_an_han_goc_thang" class="w-full p-2 border rounded" value="60">
                        </div>
                    </div>
                </div>
                
                <table class="w-full">
                    <thead>
                        <tr>
                            <th>Đợt thanh toán</th>
                            <th>Tỷ lệ (%)</th>
                            <th>Số tiền (VNĐ)</th>
                            <th>Tiến độ / Thời gian</th>
                            <th>Thời gian</th>
                        </tr>
                    </thead>
                    <tbody id="pttt_vay_table">
                        <!-- JS sẽ điền bảng này -->
                    </tbody>
                </table>
                
                <div class="mt-6">
                    <h4 class="text-lg font-bold mb-2">Thông tin trả góp</h4>
                    <table class="w-full">
                        <tbody id="thong_tin_tra_gop">
                            <!-- JS sẽ điền bảng này -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- SO SÁNH VÀ KHUYẾN NGHỊ PHƯƠNG THỨC THANH TOÁN -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">SO SÁNH VÀ KHUYẾN NGHỊ PHƯƠNG THỨC THANH TOÁN</h2>
            
            <table class="w-full comparison-table">
                <thead>
                    <tr>
                        <th>Tiêu chí</th>
                        <th>PTTT Chuẩn</th>
                        <th>PTTT Nhanh</th>
                        <th>PTTT Hỗ trợ vay</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Số tiền cọc ban đầu</td>
                        <td id="coc_pttt_chuan">0 VNĐ</td>
                        <td id="coc_pttt_nhanh">0 VNĐ</td>
                        <td id="coc_pttt_vay">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Tổng số tiền cần có để ký HĐMB</td>
                        <td id="ky_hdmb_pttt_chuan">0 VNĐ</td>
                        <td id="ky_hdmb_pttt_nhanh">0 VNĐ</td>
                        <td id="ky_hdmb_pttt_vay">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Chiết khấu</td>
                        <td id="chiet_khau_pttt_chuan">Chiết khấu chung</td>
                        <td id="chiet_khau_pttt_nhanh">Chiết khấu chung + 8% (cho 60% GTCH)</td>
                        <td id="chiet_khau_pttt_vay">Chiết khấu chung</td>
                    </tr>
                    <tr>
                        <td>Tổng tiền phải thanh toán tới thời điểm nhận nhà (T+720)</td>
                        <td id="tong_tien_nhan_nha_pttt_chuan">0 VNĐ</td>
                        <td id="tong_tien_nhan_nha_pttt_nhanh">0 VNĐ</td>
                        <td id="tong_tien_nhan_nha_pttt_vay">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Ưu điểm</td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="advantage">Thanh toán theo tiến độ, giảm áp lực tài chính ban đầu</li>
                                <li class="advantage">Mỗi đợt thanh toán chỉ 2.5% GTCH</li>
                                <li class="advantage">Phù hợp với khách hàng có dòng tiền đều đặn hàng tháng</li>
                            </ul>
                        </td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="advantage">Chiết khấu lớn 8% cho 60% GTCH</li>
                                <li class="advantage">Tiết kiệm tổng chi phí so với các PTTT khác</li>
                                <li class="advantage">Thanh toán sớm giảm rủi ro biến động lãi suất</li>
                            </ul>
                        </td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="advantage">Chỉ cần 8.6% GTCH để nhận nhà</li>
                                <li class="advantage">Được hỗ trợ lãi suất trong 24 tháng</li>
                                <li class="advantage">Ân hạn nợ gốc trong thời gian đầu</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td>Nhược điểm</td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="disadvantage">Không có ưu đãi chiết khấu đặc biệt</li>
                                <li class="disadvantage">Tổng chi phí cao hơn PTTT Nhanh</li>
                                <li class="disadvantage">Phải thanh toán 70% GTCH trước khi nhận nhà</li>
                            </ul>
                        </td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="disadvantage">Yêu cầu nguồn vốn lớn ban đầu (70% GTCH)</li>
                                <li class="disadvantage">Áp lực tài chính cao trong thời gian ngắn</li>
                                <li class="disadvantage">Không phù hợp với người có vốn hạn chế</li>
                            </ul>
                        </td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="disadvantage">Chi phí lãi vay phát sinh sau thời gian hỗ trợ</li>
                                <li class="disadvantage">Tổng chi phí cao nhất trong dài hạn</li>
                                <li class="disadvantage">Rủi ro biến động lãi suất sau thời gian ưu đãi</li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div id="recommendation" class="recommendation mt-6">
                <h3 class="text-xl font-bold mb-2">Khuyến nghị cho khách hàng:</h3>
                <p id="recommendation_text" class="text-lg">Vui lòng nhập thông tin tài chính và thực hiện tính toán để nhận khuyến nghị phù hợp.</p>
            </div>
        </div>
        
        <div class="mt-6 text-center">
            <p class="text-gray-600">Công cụ tính dòng tiền The Privé - Phiên bản 3.0</p>
            <p class="text-gray-600">Đại lý chiến lược OneS | HOTLINE: 090 398 3737</p>
        </div>
    </div>

    <script>
        // Dữ liệu căn hộ
        const apartmentData = {
            // Dữ liệu căn hộ Tháp 5
            "5": {
                "01": {
                    "type": "A1-1",
                    "area_wall": 98.50,
                    "area_carpet": 89.70,
                    "direction": "Đông Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/R0kStcS3/TW5-6-7-CH-A1-1.jpg",
                    "bedrooms": 3
                },
                "02": {
                    "type": "C1-1",
                    "area_wall": 49.80,
                    "area_carpet": 44.70,
                    "direction": "Đông Nam",
                    "view": "Nội khu, Thành phố",
                    "layout_url": "https://i.postimg.cc/hvSq8sHG/TW5-6-7-CH-C1-1.jpg",
                    "bedrooms": 1
                },
                "03": {
                    "type": "B4-1",
                    "area_wall": 76.30,
                    "area_carpet": 70.20,
                    "direction": "Nam",
                    "view": "Nội khu, Thành phố",
                    "layout_url": "https://i.postimg.cc/CKqYwzGw/TW5-6-7-CH-B4-1.jpg",
                    "bedrooms": 2
                },
                "04": {
                    "type": "B5-1",
                    "area_wall": 80.60,
                    "area_carpet": 73.30,
                    "direction": "Tây Nam",
                    "view": "Sông, Thành phố",
                    "layout_url": "https://i.postimg.cc/B6501k7y/TW5-6-7-CH-B5-1.jpg",
                    "bedrooms": 2
                },
                "05": {
                    "type": "B6-1",
                    "area_wall": 81.00,
                    "area_carpet": 73.90,
                    "direction": "Tây Nam",
                    "view": "Sông, Thành phố",
                    "layout_url": "https://i.postimg.cc/mDW4kBjC/TW5-6-7-CH-B6-1.jpg",
                    "bedrooms": 2
                },
                "06": {
                    "type": "A2-1",
                    "area_wall": 98.50,
                    "area_carpet": 89.40,
                    "direction": "Tây Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/kGcqLzx8/TW5-6-7-CH-A2-1.jpg",
                    "bedrooms": 3
                },
                "07": {
                    "type": "B1-1",
                    "area_wall": 80.90,
                    "area_carpet": 74.90,
                    "direction": "Bắc",
                    "view": "Nội khu, Thành phố",
                    "layout_url": "https://i.postimg.cc/DfdvWJtZ/TW5-6-7-CH-B1-1.jpg",
                    "bedrooms": 2
                },
                "08": {
                    "type": "B2-1",
                    "area_wall": 88.70,
                    "area_carpet": 80.70,
                    "direction": "Đông Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/jdxsyqbh/TW5-6-7-CH-B2-1.jpg",
                    "bedrooms": 2
                },
                "09": {
                    "type": "B3-1",
                    "area_wall": 71.50,
                    "area_carpet": 64.90,
                    "direction": "Đông Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/FzmhWNJN/TW5-6-7-CH-B3-1.jpg",
                    "bedrooms": 2
                }
            },
            // Dữ liệu căn hộ Tháp 6 (giữ nguyên như tháp 5 cho demo)
            "6": {
                "01": {
                    "type": "A1-1",
                    "area_wall": 98.50,
                    "area_carpet": 89.70,
                    "direction": "Đông Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/R0kStcS3/TW5-6-7-CH-A1-1.jpg",
                    "bedrooms": 3
                },
                "02": {
                    "type": "C1-1",
                    "area_wall": 49.80,
                    "area_carpet": 44.70,
                    "direction": "Đông Nam",
                    "view": "Nội khu, Thành phố",
                    "layout_url": "https://i.postimg.cc/hvSq8sHG/TW5-6-7-CH-C1-1.jpg",
                    "bedrooms": 1
                },
                "03": {
                    "type": "B4-1",
                    "area_wall": 76.30,
                    "area_carpet": 70.20,
                    "direction": "Nam",
                    "view": "Nội khu, Thành phố",
                    "layout_url": "https://i.postimg.cc/CKqYwzGw/TW5-6-7-CH-B4-1.jpg",
                    "bedrooms": 2
                },
                "04": {
                    "type": "B5-1",
                    "area_wall": 80.60,
                    "area_carpet": 73.30,
                    "direction": "Tây Nam",
                    "view": "Sông, Thành phố",
                    "layout_url": "https://i.postimg.cc/B6501k7y/TW5-6-7-CH-B5-1.jpg",
                    "bedrooms": 2
                },
                "05": {
                    "type": "B6-1",
                    "area_wall": 81.00,
                    "area_carpet": 73.90,
                    "direction": "Tây Nam",
                    "view": "Sông, Thành phố",
                    "layout_url": "https://i.postimg.cc/mDW4kBjC/TW5-6-7-CH-B6-1.jpg",
                    "bedrooms": 2
                },
                "06": {
                    "type": "A2-1",
                    "area_wall": 98.50,
                    "area_carpet": 89.40,
                    "direction": "Tây Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/kGcqLzx8/TW5-6-7-CH-A2-1.jpg",
                    "bedrooms": 3
                },
                "07": {
                    "type": "B1-1",
                    "area_wall": 80.90,
                    "area_carpet": 74.90,
                    "direction": "Bắc",
                    "view": "Nội khu, Thành phố",
                    "layout_url": "https://i.postimg.cc/DfdvWJtZ/TW5-6-7-CH-B1-1.jpg",
                    "bedrooms": 2
                },
                "08": {
                    "type": "B2-1",
                    "area_wall": 88.70,
                    "area_carpet": 80.70,
                    "direction": "Đông Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/jdxsyqbh/TW5-6-7-CH-B2-1.jpg",
                    "bedrooms": 2
                },
                "09": {
                    "type": "B3-1",
                    "area_wall": 71.50,
                    "area_carpet": 64.90,
                    "direction": "Đông Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/FzmhWNJN/TW5-6-7-CH-B3-1.jpg",
                    "bedrooms": 2
                }
            },
            // Dữ liệu căn hộ Tháp 7 (giữ nguyên như tháp 5 cho demo)
            "7": {
                "01": {
                    "type": "A1-1",
                    "area_wall": 98.50,
                    "area_carpet": 89.70,
                    "direction": "Đông Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/R0kStcS3/TW5-6-7-CH-A1-1.jpg",
                    "bedrooms": 3
                },
                "02": {
                    "type": "C1-1",
                    "area_wall": 49.80,
                    "area_carpet": 44.70,
                    "direction": "Đông Nam",
                    "view": "Nội khu, Thành phố",
                    "layout_url": "https://i.postimg.cc/hvSq8sHG/TW5-6-7-CH-C1-1.jpg",
                    "bedrooms": 1
                },
                "03": {
                    "type": "B4-1",
                    "area_wall": 76.30,
                    "area_carpet": 70.20,
                    "direction": "Nam",
                    "view": "Nội khu, Thành phố",
                    "layout_url": "https://i.postimg.cc/CKqYwzGw/TW5-6-7-CH-B4-1.jpg",
                    "bedrooms": 2
                },
                "04": {
                    "type": "B5-1",
                    "area_wall": 80.60,
                    "area_carpet": 73.30,
                    "direction": "Tây Nam",
                    "view": "Sông, Thành phố",
                    "layout_url": "https://i.postimg.cc/B6501k7y/TW5-6-7-CH-B5-1.jpg",
                    "bedrooms": 2
                },
                "05": {
                    "type": "B6-1",
                    "area_wall": 81.00,
                    "area_carpet": 73.90,
                    "direction": "Tây Nam",
                    "view": "Sông, Thành phố",
                    "layout_url": "https://i.postimg.cc/mDW4kBjC/TW5-6-7-CH-B6-1.jpg",
                    "bedrooms": 2
                },
                "06": {
                    "type": "A2-1",
                    "area_wall": 98.50,
                    "area_carpet": 89.40,
                    "direction": "Tây Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/kGcqLzx8/TW5-6-7-CH-A2-1.jpg",
                    "bedrooms": 3
                },
                "07": {
                    "type": "B1-1",
                    "area_wall": 80.90,
                    "area_carpet": 74.90,
                    "direction": "Bắc",
                    "view": "Nội khu, Thành phố",
                    "layout_url": "https://i.postimg.cc/DfdvWJtZ/TW5-6-7-CH-B1-1.jpg",
                    "bedrooms": 2
                },
                "08": {
                    "type": "B2-1",
                    "area_wall": 88.70,
                    "area_carpet": 80.70,
                    "direction": "Đông Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/jdxsyqbh/TW5-6-7-CH-B2-1.jpg",
                    "bedrooms": 2
                },
                "09": {
                    "type": "B3-1",
                    "area_wall": 71.50,
                    "area_carpet": 64.90,
                    "direction": "Đông Bắc",
                    "view": "Công viên, Thành phố",
                    "layout_url": "https://i.postimg.cc/FzmhWNJN/TW5-6-7-CH-B3-1.jpg",
                    "bedrooms": 2
                }
            },
            // Dữ liệu căn hộ Tháp 8 (mới bổ sung)
            "8": {
                "01": {
                    "type": "B3-2",
                    "area_wall": 71.50,
                    "area_carpet": 64.90,
                    "direction": "Chính Bắc (có cửa sổ/ban công phụ hướng Đông)",
                    "view": "Cao tốc TP.HCM-Long Thành-Dầu Giây, Đường sắt đô thị, Khu liên hợp TDTT",
                    "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-B3-2.jpg",
                    "bedrooms": 2
                },
                "02": {
                    "type": "B2-2",
                    "area_wall": 88.70,
                    "area_carpet": 80.70,
                    "direction": "Chính Đông",
                    "view": "Cao tốc TP.HCM-Long Thành-Dầu Giây, Đường sắt đô thị, Sông Giồng Ông Tố",
                    "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW-8---CH-B2-2.jpg",
                    "bedrooms": 2
                },
                "03": {
                    "type": "B1-2",
                    "area_wall": 80.90,
                    "area_carpet": 74.90,
                    "direction": "Chính Đông (có cửa sổ/ban công phụ hướng Nam)",
                    "view": "Cao tốc TP.HCM-Long Thành-Dầu Giây, Sông Giồng Ông Tố, Cầu Phú Mỹ",
                    "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-B1-2.jpg",
                    "bedrooms": 2
                },
                "04": {
                    "type": "A2a-2",
                    "area_wall": 98.50,
                    "area_carpet": 89.40,
                    "direction": "Chính Nam (có cửa sổ/ban công phụ hướng Đông)",
                    "view": "Sông Giồng Ông Tố, Cầu Phú Mỹ, Cảng Cát Lái, Cầu Cát Lái",
                    "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-A2-2.jpg",
                    "bedrooms": 3
                },
                "05": {
                    "type": "B6-2",
                    "area_wall": 81.00,
                    "area_carpet": 73.90,
                    "direction": "Chính Nam",
                    "view": "Sông Giồng Ông Tố, Cầu Phú Mỹ, Cảng Cát Lái, Cầu Cát Lái",
                    "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW-8---CH-B6-2.jpg",
                    "bedrooms": 2
                },
                "06": {
                    "type": "B5-2",
                    "area_wall": 80.60,
                    "area_carpet": 73.30,
                    "direction": "Chính Tây (có cửa sổ/ban công phụ hướng Nam)",
                    "view": "Sông Giồng Ông Tố, Nút giao An Phú, Ga Thủ Thiêm, Landmark 81",
                    "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-B5-2.jpg",
                    "bedrooms": 2
                },
                "07": {
                    "type": "B4-2",
                    "area_wall": 76.30,
                    "area_carpet": 70.20,
                    "direction": "Chính Tây",
                    "view": "Sông Giồng Ông Tố, Nút giao An Phú, Ga Thủ Thiêm, Landmark 81",
                    "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-B4-2.jpg",
                    "bedrooms": 2
                },
                "08": {
                    "type": "C1-2",
                    "area_wall": 49.80,
                    "area_carpet": 44.70,
                    "direction": "Chính Tây",
                    "view": "Sông Giồng Ông Tố, Nút giao An Phú, Ga Thủ Thiêm, Landmark 81",
                    "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-C1-2.jpg",
                    "bedrooms": 1
                },
                "09": {
                    "type": "A1-2",
                    "area_wall": 98.50,
                    "area_carpet": 89.70,
                    "direction": "Chính Bắc (có cửa sổ/ban công phụ hướng Tây)",
                    "view": "Cao tốc TP.HCM-Long Thành-Dầu Giây, Đường sắt đô thị, Khu liên hợp TDTT",
                    "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-A1-2.jpg",
                    "bedrooms": 3
                }
            }
        };

        // Hình ảnh mặt bằng tầng
        const floorPlanImages = {
            "5": {
                "normal": "https://i.postimg.cc/52vKWZXz/MB-TANG-DIEN-HINH-THAP-5-6-7.png",
                "20": "https://i.postimg.cc/Gh4SqBrq/MB-TANG-20-THAP-5-6-7.png",
                "21": "https://i.postimg.cc/TYBNSR3G/MB-TANG-21-THAP-5-6-7.png"
            },
            "6": {
                "normal": "https://i.postimg.cc/52vKWZXz/MB-TANG-DIEN-HINH-THAP-5-6-7.png",
                "20": "https://i.postimg.cc/Gh4SqBrq/MB-TANG-20-THAP-5-6-7.png",
                "21": "https://i.postimg.cc/TYBNSR3G/MB-TANG-21-THAP-5-6-7.png"
            },
            "7": {
                "normal": "https://i.postimg.cc/52vKWZXz/MB-TANG-DIEN-HINH-THAP-5-6-7.png",
                "20": "https://i.postimg.cc/Gh4SqBrq/MB-TANG-20-THAP-5-6-7.png",
                "21": "https://i.postimg.cc/TYBNSR3G/MB-TANG-21-THAP-5-6-7.png"
            },
            "8": {
                "normal": "https://sv1.anhsieuviet.com/2025/05/23/TANG-DIEN-HINH_TW8.png",
                "20": "https://sv1.anhsieuviet.com/2025/05/23/TANG-20_TW8.png",
                "21": "https://sv1.anhsieuviet.com/2025/05/23/TANG-21_TW8.png"
            }
        };

        // Mặt bằng tổng của từng tháp
        const totalPlanImages = {
            "5": "https://lh3.googleusercontent.com/d/1dmKiMsmvS5YTtj5pZ7bSWfE8FGta_EHD",
            "6": "https://lh3.googleusercontent.com/d/1dmKiMsmvS5YTtj5pZ7bSWfE8FGta_EHD",
            "7": "https://lh3.googleusercontent.com/d/1dmKiMsmvS5YTtj5pZ7bSWfE8FGta_EHD",
            "8": "https://sv1.anhsieuviet.com/2025/05/23/MT-BNG-TNG-THAP-TW8.png"
        };

        // Global variables
        let gia_ban_cuoi_cung_gom_vat_sau_ck_chung = 0;
        let phi_bao_tri_amount = 0;
        let selectedTower = "";
        let selectedApartment = "";
        let selectedFloor = "";
        
        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount).replace('₫', 'VNĐ');
        }
        
        // Format percentage
        function formatPercent(value) {
            return value.toFixed(2).replace(/\.00$/, '');
        }
        
        // Handle tower selection
        document.getElementById('tower').addEventListener('change', function() {
            selectedTower = this.value;
            const apartmentCodeSelect = document.getElementById('apartment_code');
            apartmentCodeSelect.innerHTML = '<option value="">Chọn mã căn hộ</option>';
            apartmentCodeSelect.disabled = !this.value;
            
            if (this.value) {
                // Update mặt bằng tổng
                document.getElementById('mat_bang_tong').src = totalPlanImages[this.value];
                
                // Add apartment options
                for (const code in apartmentData[this.value]) {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = code;
                    apartmentCodeSelect.appendChild(option);
                }
                
                // Reset floor selection
                document.getElementById('floor').innerHTML = '<option value="">Chọn tầng</option>';
                document.getElementById('floor').disabled = true;
                
                // Reset values
                document.getElementById('ma_can_ho').value = '';
                document.getElementById('dien_tich_tim_tuong').value = '';
                document.getElementById('dien_tich_thong_thuy').value = '';
                document.getElementById('huong_can').value = '';
                document.getElementById('view_can').value = '';
                document.getElementById('loai_can_ho').value = '';
                document.getElementById('layout_image').classList.add('hidden');
            }
        });
        
        // Handle apartment code selection
        document.getElementById('apartment_code').addEventListener('change', function() {
            selectedApartment = this.value;
            const floorSelect = document.getElementById('floor');
            floorSelect.innerHTML = '<option value="">Chọn tầng</option>';
            floorSelect.disabled = !this.value;
            
            if (this.value) {
                // Populate floor options
                // In tháp 8, căn số 05 (B6-2) không có ở tầng 20 và 21
                if (selectedTower === "8" && selectedApartment === "05") {
                    for (let i = 4; i <= 19; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = i;
                        floorSelect.appendChild(option);
                    }
                    for (let i = 22; i <= 31; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = i;
                        floorSelect.appendChild(option);
                    }
                } else {
                    for (let i = 4; i <= 31; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = i;
                        floorSelect.appendChild(option);
                    }
                }
            }
        });
        
        // Handle floor selection
        document.getElementById('floor').addEventListener('change', function() {
            selectedFloor = this.value;
            
            if (this.value) {
                const apartmentInfo = apartmentData[selectedTower][selectedApartment];
                
                // Update floor plan image based on floor
                let floorPlanImage;
                if (this.value == 20) {
                    floorPlanImage = floorPlanImages[selectedTower]["20"];
                } else if (this.value == 21) {
                    floorPlanImage = floorPlanImages[selectedTower]["21"];
                } else {
                    floorPlanImage = floorPlanImages[selectedTower]["normal"];
                }
                
                document.getElementById('mat_bang_tang').src = floorPlanImage;
                
                // Update apartment info
                document.getElementById('ma_can_ho').value = `${selectedTower}-${selectedFloor}-${selectedApartment}`;
                document.getElementById('dien_tich_tim_tuong').value = apartmentInfo.area_wall;
                document.getElementById('dien_tich_thong_thuy').value = apartmentInfo.area_carpet;
                document.getElementById('huong_can').value = apartmentInfo.direction;
                document.getElementById('view_can').value = apartmentInfo.view;
                document.getElementById('loai_can_ho').value = `${apartmentInfo.type} (${apartmentInfo.bedrooms} Phòng ngủ)`;
                
                // Show layout image
                const layoutImage = document.getElementById('layout_image');
                layoutImage.src = apartmentInfo.layout_url;
                layoutImage.classList.remove('hidden');
            }
        });
        
        // Show active tab
        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const buttons = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        // Calculate button click handler
        document.getElementById('calculate_btn').addEventListener('click', calculateAll);
        
        // Calculate all values
        function calculateAll() {
            // Get input values
            const dien_tich_tim_tuong = parseFloat(document.getElementById('dien_tich_tim_tuong').value) || 0;
            const gia_m2 = parseFloat(document.getElementById('gia_m2').value) || 0;
            const vat_percent = parseFloat(document.getElementById('vat_percent').value) || 10;
            const phi_bao_tri_percent = parseFloat(document.getElementById('phi_bao_tri_percent').value) || 2;
            
            // Calculate basic apartment value
            const gia_ban_can_ho_truoc_vat = dien_tich_tim_tuong * gia_m2;
            const vat_amount = gia_ban_can_ho_truoc_vat * (vat_percent / 100);
            const tong_gia_ban_can_ho_gom_vat_ban_dau = gia_ban_can_ho_truoc_vat + vat_amount;
            phi_bao_tri_amount = gia_ban_can_ho_truoc_vat * (phi_bao_tri_percent / 100);
            
            // Calculate common discount
            const chiet_khau_nguyen_vong_percent = document.getElementById('chiet_khau_nguyen_vong').checked ? 3 : 0;
            
            // Check if any special discount checkbox is checked
            let chiet_khau_dac_biet_percent = 0;
            const chiet_khau_dac_biet_checkboxes = document.querySelectorAll('.chiet_khau_dac_biet');
            for (const checkbox of chiet_khau_dac_biet_checkboxes) {
                if (checkbox.checked) {
                    chiet_khau_dac_biet_percent = 2;
                    break;
                }
            }
            
            // Get multiple product discount
            const chiet_khau_mua_nhieu_percent = parseFloat(document.querySelector('input[name="chiet_khau_mua_nhieu"]:checked').value) || 0;
            
            // Calculate total common discount
            const tong_phan_tram_chiet_khau_chung = chiet_khau_nguyen_vong_percent + chiet_khau_dac_biet_percent + chiet_khau_mua_nhieu_percent;
            const tong_tien_chiet_khau_chung = tong_gia_ban_can_ho_gom_vat_ban_dau * (tong_phan_tram_chiet_khau_chung / 100);
            gia_ban_cuoi_cung_gom_vat_sau_ck_chung = tong_gia_ban_can_ho_gom_vat_ban_dau - tong_tien_chiet_khau_chung;
            
            // Get voucher discount
            const voucher_chiet_khau_value = parseFloat(document.querySelector('input[name="voucher_chiet_khau"]:checked').value) || 0;
            const voucher_amount = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * (voucher_chiet_khau_value / 100);

            // Show/Hide voucher row
            const voucherRow = document.getElementById('voucher_chiet_khau_row');
            if (voucher_chiet_khau_value > 0) {
                voucherRow.classList.remove('hidden');
                document.getElementById('voucher_percent_display').textContent = voucher_chiet_khau_value;
                document.getElementById('voucher_amount').textContent = formatCurrency(voucher_amount);
            } else {
                voucherRow.classList.add('hidden');
            }

            // Update display values
            document.getElementById('gia_ban_can_ho_truoc_vat').textContent = formatCurrency(gia_ban_can_ho_truoc_vat);
            document.getElementById('vat_percent_display').textContent = vat_percent;
            document.getElementById('vat_amount').textContent = formatCurrency(vat_amount);
            document.getElementById('tong_gia_ban_can_ho_gom_vat_ban_dau').textContent = formatCurrency(tong_gia_ban_can_ho_gom_vat_ban_dau);
            document.getElementById('phi_bao_tri_percent_display').textContent = phi_bao_tri_percent;
            document.getElementById('phi_bao_tri_amount').textContent = formatCurrency(phi_bao_tri_amount);
            document.getElementById('tong_phan_tram_chiet_khau_chung').textContent = formatPercent(tong_phan_tram_chiet_khau_chung);
            document.getElementById('tong_tien_chiet_khau_chung').textContent = formatCurrency(tong_tien_chiet_khau_chung);
            document.getElementById('gia_ban_cuoi_cung_gom_vat_sau_ck_chung').textContent = formatCurrency(gia_ban_cuoi_cung_gom_vat_sau_ck_chung);
            
            // Calculate payment schedules
            calculatePTTTChuan();
            calculatePTTTNhanh();
            calculatePTTTVay();
            
            // Compare and recommend
            compareAndRecommend();
        }
        
        // Calculate Standard Payment Method (Phương thức thanh toán chuẩn)
        function calculatePTTTChuan() {
            const tien_dat_coc = 100000000;
            const dot_1_ky_hdmb = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.1;
            const dot_1_thuc_dong = Math.max(0, dot_1_ky_hdmb - tien_dat_coc);
            
            // Build the payment table
            let html = '';
            
            // Đặt cọc
            html += `
                <tr>
                    <td>Đặt cọc</td>
                    <td>-</td>
                    <td>${formatCurrency(tien_dat_coc)}</td>
                    <td>Ký phiếu đặt cọc</td>
                    <td>T</td>
                </tr>
            `;
            
            // Đợt 1
            html += `
                <tr>
                    <td>Đợt 1</td>
                    <td>10%</td>
                    <td>${formatCurrency(dot_1_thuc_dong)}</td>
                    <td>Ký HĐMB (đã bao gồm đặt cọc)</td>
                    <td>T+30</td>
                </tr>
            `;
            
            // Đợt 2-25 (2.5% mỗi đợt)
            let tong_thanh_toan = tien_dat_coc + dot_1_thuc_dong;
            for (let i = 2; i <= 25; i++) {
                const tien_dot_i = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.025;
                tong_thanh_toan += tien_dot_i;
                html += `
                    <tr>
                        <td>Đợt ${i}</td>
                        <td>2.5%</td>
                        <td>${formatCurrency(tien_dot_i)}</td>
                        <td>Đóng vào ngày ${i*30-30} sau HĐMB</td>
                        <td>T+${i*30}</td>
                    </tr>
                `;
            }
            
            // Đợt bàn giao căn hộ (25%)
            const dot_ban_giao = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.25;
            tong_thanh_toan += dot_ban_giao;
            html += `
                <tr>
                    <td>Đợt bàn giao căn hộ</td>
                    <td>25%</td>
                    <td>${formatCurrency(dot_ban_giao)}</td>
                    <td>Khi nhận thông báo bàn giao căn hộ</td>
                    <td>T+720</td>
                </tr>
            `;
            
            // Đợt nhận GCN (5%)
            const dot_nhan_gcn = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.05;
            tong_thanh_toan += dot_nhan_gcn;
            html += `
                <tr>
                    <td>Đợt nhận GCN</td>
                    <td>5%</td>
                    <td>${formatCurrency(dot_nhan_gcn)}</td>
                    <td>Khi nhận thông báo GCN</td>
                    <td>T+840</td>
                </tr>
            `;
            
            // Phí bảo trì
            tong_thanh_toan += phi_bao_tri_amount;
            html += `
                <tr>
                    <td>Phí bảo trì</td>
                    <td>2%</td>
                    <td>${formatCurrency(phi_bao_tri_amount)}</td>
                    <td>Khi nhận bàn giao căn hộ</td>
                    <td>T+720</td>
                </tr>
            `;
            
            // Tổng cộng
            html += `
                <tr class="font-bold bg-blue-100">
                    <td>Tổng cộng</td>
                    <td>100%</td>
                    <td>${formatCurrency(tong_thanh_toan)}</td>
                    <td colspan="2"></td>
                </tr>
            `;
            
            // Update the table
            document.getElementById('pttt_chuan_table').innerHTML = html;
            
            // Save values for comparison
            document.getElementById('coc_pttt_chuan').textContent = formatCurrency(tien_dat_coc);
            document.getElementById('ky_hdmb_pttt_chuan').textContent = formatCurrency(dot_1_ky_hdmb);
            
            // Calculate total payment until receiving apartment
            const tong_tien_nhan_nha_chuan = tien_dat_coc + dot_1_thuc_dong + (gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.025 * 24) + dot_ban_giao + phi_bao_tri_amount;
            document.getElementById('tong_tien_nhan_nha_pttt_chuan').textContent = formatCurrency(tong_tien_nhan_nha_chuan);
        }
        
        // Calculate Fast Payment Method (Phương thức thanh toán nhanh)
        function calculatePTTTNhanh() {
            const tien_dat_coc = 100000000;
            const dot_1_ky_hdmb = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.1;
            const dot_1_thuc_dong = Math.max(0, dot_1_ky_hdmb - tien_dat_coc);
            
            const dot_2_thanh_toan_60_percent = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.6;
            const chiet_khau_thanh_toan_nhanh_amount = dot_2_thanh_toan_60_percent * 0.08;
            const dot_2_thuc_dong = dot_2_thanh_toan_60_percent - chiet_khau_thanh_toan_nhanh_amount;
            
            const dot_ban_giao = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.25;
            const dot_nhan_gcn = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.05;
            
            // Build the payment table
            let html = '';
            
            // Đặt cọc
            html += `
                <tr>
                    <td>Đặt cọc</td>
                    <td>-</td>
                    <td>${formatCurrency(tien_dat_coc)}</td>
                    <td>Ký phiếu đặt cọc</td>
                    <td>T</td>
                </tr>
            `;
            
            // Đợt 1
            html += `
                <tr>
                    <td>Đợt 1</td>
                    <td>10%</td>
                    <td>${formatCurrency(dot_1_thuc_dong)}</td>
                    <td>Ký HĐMB (đã bao gồm đặt cọc)</td>
                    <td>T+30</td>
                </tr>
            `;
            
            // Đợt 2
            html += `
                <tr>
                    <td>Đợt 2</td>
                    <td>60%</td>
                    <td>${formatCurrency(dot_2_thuc_dong)}</td>
                    <td>Trong vòng 15 ngày sau khi ký HĐMB (đã trừ CK 8%: ${formatCurrency(chiet_khau_thanh_toan_nhanh_amount)})</td>
                    <td>T+45</td>
                </tr>
            `;
            
            // Đợt bàn giao căn hộ
            html += `
                <tr>
                    <td>Đợt bàn giao căn hộ</td>
                    <td>25%</td>
                    <td>${formatCurrency(dot_ban_giao)}</td>
                    <td>Khi nhận thông báo bàn giao căn hộ</td>
                    <td>T+720</td>
                </tr>
            `;
            
            // Đợt nhận GCN
            html += `
                <tr>
                    <td>Đợt nhận GCN</td>
                    <td>5%</td>
                    <td>${formatCurrency(dot_nhan_gcn)}</td>
                    <td>Khi nhận thông báo GCN</td>
                    <td>T+840</td>
                </tr>
            `;
            
            // Phí bảo trì
            html += `
                <tr>
                    <td>Phí bảo trì</td>
                    <td>2%</td>
                    <td>${formatCurrency(phi_bao_tri_amount)}</td>
                    <td>Khi nhận bàn giao căn hộ</td>
                    <td>T+720</td>
                </tr>
            `;
            
            // Tổng cộng
            const tong_thanh_toan = tien_dat_coc + dot_1_thuc_dong + dot_2_thuc_dong + dot_ban_giao + dot_nhan_gcn + phi_bao_tri_amount;
            html += `
                <tr class="font-bold bg-blue-100">
                    <td>Tổng cộng</td>
                    <td>100%</td>
                    <td>${formatCurrency(tong_thanh_toan)}</td>
                    <td colspan="2"></td>
                </tr>
            `;
            
            // Update the table
            document.getElementById('pttt_nhanh_table').innerHTML = html;
            document.getElementById('chiet_khau_thanh_toan_nhanh_amount').textContent = formatCurrency(chiet_khau_thanh_toan_nhanh_amount);
            
            // Save values for comparison
            document.getElementById('coc_pttt_nhanh').textContent = formatCurrency(tien_dat_coc);
            document.getElementById('ky_hdmb_pttt_nhanh').textContent = formatCurrency(dot_1_ky_hdmb);
            
            // Calculate total payment until receiving apartment
            const tong_tien_nhan_nha_nhanh = tien_dat_coc + dot_1_thuc_dong + dot_2_thuc_dong + dot_ban_giao + phi_bao_tri_amount;
            document.getElementById('tong_tien_nhan_nha_pttt_nhanh').textContent = formatCurrency(tong_tien_nhan_nha_nhanh);
        }
        
        // Calculate Loan Support Method (Phương thức hỗ trợ vay ưu đãi)
        function calculatePTTTVay() {
            const tien_dat_coc = 100000000;
            
            // Đợt 1: VTC 8.6%
            const dot_1_ky_hdmb_von_tu_co_percent = 8.6;
            const dot_1_ky_hdmb_von_tu_co_amount = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * (dot_1_ky_hdmb_von_tu_co_percent / 100);
            const dot_1_thuc_dong = Math.max(0, dot_1_ky_hdmb_von_tu_co_amount - tien_dat_coc);
            
            // Ngân hàng giải ngân đợt 1: 61.4%
            const ngan_hang_giai_ngan_dot_1_percent = 61.4;
            const ngan_hang_giai_ngan_dot_1_amount = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * (ngan_hang_giai_ngan_dot_1_percent / 100);
            
            // Bàn giao khách thanh toán: 20%
            const ban_giao_khach_thanh_toan_percent = 20;
            const ban_giao_khach_thanh_toan_amount = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * (ban_giao_khach_thanh_toan_percent / 100);
            
            // Bàn giao ngân hàng thanh toán: 5%
            const ban_giao_ngan_hang_thanh_toan_percent = 5;
            const ban_giao_ngan_hang_thanh_toan_amount = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * (ban_giao_ngan_hang_thanh_toan_percent / 100);
            
            // Nhận GCN: 5%
            const dot_nhan_gcn_percent = 5;
            const dot_nhan_gcn_amount = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * (dot_nhan_gcn_percent / 100);
            
            // Tổng vốn tự có và vay
            const tong_von_tu_co_khach_hang = dot_1_ky_hdmb_von_tu_co_amount + ban_giao_khach_thanh_toan_amount + dot_nhan_gcn_amount;
            const tong_so_tien_vay_ngan_hang = ngan_hang_giai_ngan_dot_1_amount + ban_giao_ngan_hang_thanh_toan_amount;
            
            // Thông tin vay
            const lai_suat_vay_uu_dai_nam = parseFloat(document.getElementById('lai_suat_vay_uu_dai_nam').value) || 0;
            const thoi_gian_vay_nam = parseFloat(document.getElementById('thoi_gian_vay_nam').value) || 30;
            const thoi_gian_ho_tro_lai_suat_thang = parseFloat(document.getElementById('thoi_gian_ho_tro_lai_suat_thang').value) || 24;
            const thoi_gian_an_han_goc_thang = parseFloat(document.getElementById('thoi_gian_an_han_goc_thang').value) || 60;
            
            // Tính lãi suất tháng
            const lai_suat_thang = lai_suat_vay_uu_dai_nam / 12 / 100;
            
            // Tính số tiền trả mỗi tháng sau thời gian ân hạn
            const thoi_gian_vay_con_lai = thoi_gian_vay_nam * 12 - thoi_gian_an_han_goc_thang;
            const r = Math.pow(1 + lai_suat_thang, thoi_gian_vay_con_lai);
            const goc_lai_hang_thang = tong_so_tien_vay_ngan_hang * lai_suat_thang * r / (r - 1);
            
            // Tính lãi hàng tháng trong thời gian ân hạn sau khi hết hỗ trợ lãi suất
            const lai_hang_thang = tong_so_tien_vay_ngan_hang * lai_suat_thang;
            
            // Build the payment table
            let html = '';
            
            // Đặt cọc
            html += `
                <tr>
                    <td>Đặt cọc</td>
                    <td>-</td>
                    <td>${formatCurrency(tien_dat_coc)}</td>
                    <td>Ký phiếu đặt cọc</td>
                    <td>T</td>
                </tr>
            `;
            
            // Đợt 1 - VTC
            html += `
                <tr>
                    <td>Đợt 1 (VTC)</td>
                    <td>${dot_1_ky_hdmb_von_tu_co_percent}%</td>
                    <td>${formatCurrency(dot_1_thuc_dong)}</td>
                    <td>Ký HĐMB (đã bao gồm đặt cọc)</td>
                    <td>T+30</td>
                </tr>
            `;
            
            // NH giải ngân đợt 1
            html += `
                <tr>
                    <td>Ngân hàng giải ngân đợt 1</td>
                    <td>${ngan_hang_giai_ngan_dot_1_percent}%</td>
                    <td>${formatCurrency(ngan_hang_giai_ngan_dot_1_amount)}</td>
                    <td>Theo thông báo của ngân hàng</td>
                    <td>T+45</td>
                </tr>
            `;
            
            // Bàn giao KH thanh toán
            html += `
                <tr>
                    <td>Khách hàng thanh toán khi bàn giao</td>
                    <td>${ban_giao_khach_thanh_toan_percent}%</td>
                    <td>${formatCurrency(ban_giao_khach_thanh_toan_amount)}</td>
                    <td>Khi nhận thông báo bàn giao căn hộ</td>
                    <td>T+720</td>
                </tr>
            `;
            
            // Bàn giao NH thanh toán
            html += `
                <tr>
                    <td>Ngân hàng thanh toán khi bàn giao</td>
                    <td>${ban_giao_ngan_hang_thanh_toan_percent}%</td>
                    <td>${formatCurrency(ban_giao_ngan_hang_thanh_toan_amount)}</td>
                    <td>Khi nhận thông báo bàn giao căn hộ</td>
                    <td>T+720</td>
                </tr>
            `;
            
            // Nhận GCN
            html += `
                <tr>
                    <td>Đợt nhận GCN</td>
                    <td>${dot_nhan_gcn_percent}%</td>
                    <td>${formatCurrency(dot_nhan_gcn_amount)}</td>
                    <td>Khi nhận thông báo GCN</td>
                    <td>T+840</td>
                </tr>
            `;
            
            // Phí bảo trì
            html += `
                <tr>
                    <td>Phí bảo trì</td>
                    <td>2%</td>
                    <td>${formatCurrency(phi_bao_tri_amount)}</td>
                    <td>Khi nhận bàn giao căn hộ</td>
                    <td>T+720</td>
                </tr>
            `;
            
            // Tổng cộng
            const tong_thanh_toan = tien_dat_coc + dot_1_thuc_dong + ngan_hang_giai_ngan_dot_1_amount + ban_giao_khach_thanh_toan_amount + ban_giao_ngan_hang_thanh_toan_amount + dot_nhan_gcn_amount + phi_bao_tri_amount;
            html += `
                <tr class="font-bold bg-blue-100">
                    <td>Tổng cộng</td>
                    <td>100%</td>
                    <td>${formatCurrency(tong_thanh_toan)}</td>
                    <td colspan="2"></td>
                </tr>
            `;
            
            // Update the table
            document.getElementById('pttt_vay_table').innerHTML = html;
            
            // Thông tin trả góp
            let infoHtml = '';
            
            // Tổng vốn tự có và vay
            infoHtml += `
                <tr>
                    <td>Tổng vốn tự có của khách hàng:</td>
                    <td>${formatCurrency(tong_von_tu_co_khach_hang)}</td>
                </tr>
                <tr>
                    <td>Tổng số tiền vay ngân hàng:</td>
                    <td>${formatCurrency(tong_so_tien_vay_ngan_hang)}</td>
                </tr>
            `;
            
            // Trả lãi hàng tháng trong thời gian ân hạn (sau thời gian hỗ trợ lãi suất)
            infoHtml += `
                <tr>
                    <td>Trả lãi hàng tháng trong thời gian ân hạn gốc (từ tháng ${thoi_gian_ho_tro_lai_suat_thang+1} đến tháng ${thoi_gian_an_han_goc_thang}):</td>
                    <td>${formatCurrency(lai_hang_thang)}/tháng</td>
                </tr>
            `;
            
            // Trả gốc + lãi sau thời gian ân hạn
            infoHtml += `
                <tr>
                    <td>Trả gốc + lãi hàng tháng sau thời gian ân hạn (từ tháng ${thoi_gian_an_han_goc_thang+1} đến tháng ${thoi_gian_vay_nam*12}):</td>
                    <td>${formatCurrency(goc_lai_hang_thang)}/tháng</td>
                </tr>
            `;
            
            // Tổng số tiền phải trả trong thời gian được hỗ trợ lãi suất
            const tong_tien_ho_tro_lai = dot_1_thuc_dong + tien_dat_coc + ban_giao_khach_thanh_toan_amount + phi_bao_tri_amount + dot_nhan_gcn_amount;
            infoHtml += `
                <tr>
                    <td>Tổng số tiền phải trả trong thời gian được hỗ trợ lãi suất (24 tháng đầu):</td>
                    <td>${formatCurrency(tong_tien_ho_tro_lai)}</td>
                </tr>
            `;
            
            // Update thông tin trả góp
            document.getElementById('thong_tin_tra_gop').innerHTML = infoHtml;
            
            // Save values for comparison
            document.getElementById('coc_pttt_vay').textContent = formatCurrency(tien_dat_coc);
            document.getElementById('ky_hdmb_pttt_vay').textContent = formatCurrency(dot_1_ky_hdmb_von_tu_co_amount);
            
            // Calculate total payment until receiving apartment (T+720)
            const tong_tien_nhan_nha_vay = tien_dat_coc + dot_1_thuc_dong + ban_giao_khach_thanh_toan_amount + phi_bao_tri_amount;
            document.getElementById('tong_tien_nhan_nha_pttt_vay').textContent = formatCurrency(tong_tien_nhan_nha_vay);
        }
        
        // Compare and recommend payment methods
        function compareAndRecommend() {
            // Get customer financial information
            const von_tu_co = parseFloat(document.getElementById('von_tu_co').value) || 0;
            const thu_nhap_hang_thang = parseFloat(document.getElementById('thu_nhap_hang_thang').value) || 0;
            
            // PTTT Chuẩn data
            const dot_1_ky_hdmb_chuan = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.1;
            const tien_dot_thang_chuan = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.025;
            
            // PTTT Nhanh data
            const dot_1_ky_hdmb_nhanh = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.1;
            const dot_2_nhanh = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.6 * 0.92; // Sau CK 8%
            
            // PTTT Vay data
            const dot_1_ky_hdmb_vay = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.086;
            const tien_lai_hang_thang = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.664 * (parseFloat(document.getElementById('lai_suat_vay_uu_dai_nam').value) || 0) / 12 / 100;
            
            // Update chiết khấu display
            const voucher_chiet_khau_value = parseFloat(document.querySelector('input[name="voucher_chiet_khau"]:checked').value) || 0;
            if (voucher_chiet_khau_value > 0) {
                document.getElementById('chiet_khau_pttt_chuan').textContent = `Chiết khấu chung + Voucher ${voucher_chiet_khau_value}%`;
                document.getElementById('chiet_khau_pttt_nhanh').textContent = `Chiết khấu chung + 8% (cho 60% GTCH) + Voucher ${voucher_chiet_khau_value}%`;
                document.getElementById('chiet_khau_pttt_vay').textContent = `Chiết khấu chung + Voucher ${voucher_chiet_khau_value}%`;
            }
            
            // Generate recommendation
            let recommendation = '';
            
            // If customer has enough money for PTTT Nhanh
            if (von_tu_co >= dot_1_ky_hdmb_nhanh + dot_2_nhanh) {
                recommendation = `
                    <p><strong class="text-blue-600">Khuyến nghị:</strong> Với khả năng tài chính của bạn (vốn tự có ${formatCurrency(von_tu_co)}), 
                    bạn nên lựa chọn <strong>PTTT Nhanh</strong> để tận dụng chiết khấu 8% cho 60% giá trị căn hộ. 
                    Điều này sẽ giúp bạn tiết kiệm tổng chi phí nhiều nhất.</p>
                    <p>Tổng số tiền tiết kiệm được với PTTT Nhanh so với PTTT Chuẩn: ${formatCurrency(gia_ban_cuoi_cung_gom_vat_sau_ck_chung * 0.6 * 0.08)}</p>
                `;
            }
            // If customer doesn't have enough for PTTT Nhanh but has enough for PTTT Chuẩn's first payments
            else if (von_tu_co >= dot_1_ky_hdmb_chuan && thu_nhap_hang_thang >= tien_dot_thang_chuan * 2) {
                recommendation = `
                    <p><strong class="text-blue-600">Khuyến nghị:</strong> Với khả năng tài chính của bạn (vốn tự có ${formatCurrency(von_tu_co)} 
                    và thu nhập hàng tháng ${formatCurrency(thu_nhap_hang_thang)}), <strong>PTTT Chuẩn</strong> là lựa chọn phù hợp. 
                    Bạn có đủ khả năng thanh toán đợt đầu và các khoản 2.5% hàng tháng một cách thoải mái.</p>
                `;
            }
            // Customer has very limited funds - recommend PTTT Vay
            else {
                recommendation = `
                    <p><strong class="text-blue-600">Khuyến nghị:</strong> Với vốn tự có hạn chế (${formatCurrency(von_tu_co)}), 
                    <strong>PTTT Hỗ trợ vay ưu đãi</strong> là lựa chọn phù hợp nhất. Bạn chỉ cần thanh toán 8.6% giá trị căn hộ ban đầu 
                    và được hỗ trợ lãi suất trong 24 tháng đầu.</p>
                    <p>Tuy nhiên, cần lưu ý rằng sau thời gian hỗ trợ lãi suất, bạn sẽ cần thanh toán khoản lãi khoảng 
                    ${formatCurrency(tien_lai_hang_thang)}/tháng.</p>
                `;
            }
            
            // If monthly income is not enough for loan payment
            if (thu_nhap_hang_thang < tien_lai_hang_thang * 3 && von_tu_co < dot_1_ky_hdmb_nhanh + dot_2_nhanh) {
                recommendation += `
                    <p class="text-red-600 font-bold mt-2">Lưu ý: Thu nhập hàng tháng của bạn có thể không đủ để thanh toán khoản vay 
                    trong dài hạn (thường ngân hàng yêu cầu thu nhập gấp 3 lần khoản trả hàng tháng). 
                    Vui lòng xem xét kỹ khả năng tài chính hoặc cân nhắc các căn hộ có giá trị phù hợp hơn.</p>
                `;
            }
            
            // Update the recommendation
            document.getElementById('recommendation_text').innerHTML = recommendation;
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Enable calculate button even if no apartment is selected
            document.getElementById('calculate_btn').addEventListener('click', calculateAll);
        });
    </script>
</body>
</html>
