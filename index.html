<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công cụ tính dòng tiền The Privé - Hoàn chỉnh Phase 1</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1, h2, h3, h4 {
            color: #2c5282;
        }
        
        .section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        table, th, td {
            border: 1px solid #e2e8f0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: #edf2f7;
        }
        
        .floor-plan-img {
            max-width: 100%;
            height: auto;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }
        
        .layout-img {
            max-width: 100%;
            height: auto;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }
        
        input[type="text"], 
        input[type="number"], 
        select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-size: 16px;
        }
        
        input[type="checkbox"],
        input[type="radio"] {
            margin-right: 8px;
        }
        
        .btn {
            padding: 10px 16px;
            background-color: #4299e1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
        }
        
        .btn:hover {
            background-color: #3182ce;
        }
        
        .tab {
            display: none;
        }
        
        .tab.active {
            display: block;
        }
        
        .price {
            font-weight: bold;
            color: #2d3748;
        }
        
        .highlight {
            background-color: #ebf8ff;
            padding: 2px 4px;
            border-radius: 4px;
        }
        
        .warning {
            color: #c53030;
            font-weight: 500;
        }
        
        .success {
            color: #2f855a;
            font-weight: 500;
        }
        
        .comparison-table th {
            background-color: #4299e1;
            color: white;
        }
        
        .comparison-table tr:nth-child(even) {
            background-color: #f7fafc;
        }
        
        .advantage {
            color: #2f855a;
        }
        
        .disadvantage {
            color: #c53030;
        }
        
        .header-logo {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 10px 15px;
            background-color: #e2e8f0;
            border: none;
            border-radius: 4px 4px 0 0;
            margin-right: 4px;
            margin-bottom: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .tab-btn.active {
            background-color: #4299e1;
            color: white;
        }
        
        .recommendation {
            background-color: #ebf8ff;
            border-left: 4px solid #4299e1;
            padding: 16px;
            margin-top: 20px;
        }
        
        @media print {
            body {
                background-color: white;
            }
            
            .section {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #e2e8f0;
            }
            
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-logo">
            <div>
                <h1 class="text-3xl font-bold mb-1">CÔNG CỤ TÍNH DÒNG TIỀN THE PRIVÉ - PHASE 1</h1>
                <h2 class="text-xl">Đại lý chiến lược OneS</h2>
                <h3 class="text-lg font-bold text-blue-600">HOTLINE: 090 398 3737</h3>
            </div>
        </div>
        
        <!-- MẶT BẰNG TỔNG -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">MẶT BẰNG TỔNG</h2>
            <div class="mb-4">
                <img id="mat_bang_tong" src="https://lh3.googleusercontent.com/d/1Zi3Fqv-aveEy42MT1tte5wtgzAW3Dhnw" alt="Mặt bằng tổng The Privé" class="floor-plan-img">
            </div>
        </div>
        
        <!-- MẶT BẰNG TẦNG ĐIỂN HÌNH -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">MẶT BẰNG TẦNG ĐIỂN HÌNH</h2>
            <div class="mb-4">
                <img id="mat_bang_tang" src="https://i.postimg.cc/52vKWZXz/MB-TANG-DIEN-HINH-THAP-5-6-7.png" alt="Mặt bằng tầng điển hình" class="floor-plan-img">
            </div>
            <p class="mb-4">Chọn tháp và tầng để xem mặt bằng tầng tương ứng</p>
        </div>
        
        <!-- THÔNG TIN CĂN HỘ -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">THÔNG TIN CĂN HỘ</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label for="tower" class="block mb-2 font-medium">Tháp:</label>
                    <select id="tower" class="w-full p-2 border rounded">
                        <option value="">Chọn tháp</option>
                        <option value="5">Tháp 5</option>
                        <option value="6">Tháp 6</option>
                        <option value="7">Tháp 7</option>
                        <option value="8">Tháp 8</option>
                    </select>
                </div>
                <div>
                    <label for="apartment_code" class="block mb-2 font-medium">Mã căn hộ:</label>
                    <select id="apartment_code" class="w-full p-2 border rounded" disabled>
                        <option value="">Chọn mã căn hộ</option>
                    </select>
                </div>
                <div>
                    <label for="floor" class="block mb-2 font-medium">Tầng:</label>
                    <select id="floor" class="w-full p-2 border rounded" disabled>
                        <option value="">Chọn tầng</option>
                    </select>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <div class="mb-4">
                        <label for="ma_can_ho" class="block mb-2 font-medium">Mã căn hộ đầy đủ:</label>
                        <input type="text" id="ma_can_ho" class="w-full p-2 border rounded" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="gia_m2" class="block mb-2 font-medium">Đơn giá gốc (VNĐ/m²):</label>
                        <input type="number" id="gia_m2" class="w-full p-2 border rounded" value="99000000">
                    </div>
                    <div class="mb-4">
                        <label for="dien_tich_tim_tuong" class="block mb-2 font-medium">Diện tích tim tường (m²):</label>
                        <input type="number" id="dien_tich_tim_tuong" class="w-full p-2 border rounded" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="dien_tich_thong_thuy" class="block mb-2 font-medium">Diện tích thông thủy (m²):</label>
                        <input type="number" id="dien_tich_thong_thuy" class="w-full p-2 border rounded" readonly>
                    </div>
                </div>
                <div>
                    <div class="mb-4">
                        <label for="huong_can" class="block mb-2 font-medium">Hướng căn hộ:</label>
                        <input type="text" id="huong_can" class="w-full p-2 border rounded" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="view_can" class="block mb-2 font-medium">View căn hộ:</label>
                        <input type="text" id="view_can" class="w-full p-2 border rounded" readonly>
                    </div>
                    <div class="mb-4">
                        <label for="loai_can_ho" class="block mb-2 font-medium">Loại căn hộ:</label>
                        <input type="text" id="loai_can_ho" class="w-full p-2 border rounded" readonly>
                    </div>
                </div>
            </div>
            
            <div id="apartment_layout" class="mt-4">
                <h3 class="text-xl font-bold mb-2">Mặt bằng căn hộ</h3>
                <img id="layout_image" src="" alt="Layout căn hộ" class="layout-img hidden">
            </div>
        </div>
        
        <!-- CÀI ĐẶT THUẾ & PHÍ -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">CÀI ĐẶT THUẾ & PHÍ</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="vat_percent" class="block mb-2 font-medium">Thuế VAT (%):</label>
                    <input type="number" id="vat_percent" class="w-full p-2 border rounded" value="10">
                </div>
                <div>
                    <label for="phi_bao_tri_percent" class="block mb-2 font-medium">Phí bảo trì (%):</label>
                    <input type="number" id="phi_bao_tri_percent" class="w-full p-2 border rounded" value="2">
                </div>
            </div>
        </div>
        
        <!-- CHÍNH SÁCH ƯU ĐÃI -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">CHÍNH SÁCH ƯU ĐÃI</h2>
            
            <!-- 1. Chiết khấu Đăng ký nguyện vọng -->
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2">1. Chiết khấu Đăng ký nguyện vọng (3%)</h3>
                <div class="mb-2">
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="chiet_khau_nguyen_vong" class="form-checkbox">
                        <span class="ml-2">Khách hàng có Đăng ký nguyện vọng giao dịch sản phẩm được ĐVKD xác nhận trước 15/06/2025?</span>
                    </label>
                </div>
            </div>
            
            <!-- 2. Chiết khấu Ưu đãi đặc biệt -->
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2">2. Chiết khấu Ưu đãi đặc biệt (Tối đa 2%)</h3>
                <div class="mb-2">
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="chiet_khau_dac_biet_1" class="form-checkbox chiet_khau_dac_biet">
                        <span class="ml-2">Khách hàng là KH đã/đang giao dịch sản phẩm do DXG làm CĐT/Nhà phát triển?</span>
                    </label>
                </div>
                <div class="mb-2">
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="chiet_khau_dac_biet_2" class="form-checkbox chiet_khau_dac_biet">
                        <span class="ml-2">Khách hàng là Cổ đông sở hữu cổ phiếu DXG/DXS từ 10,000 CP trước ngày công bố dự án?</span>
                    </label>
                </div>
                <div class="mb-2">
                    <label class="inline-flex items-center">
                        <input type="checkbox" id="chiet_khau_dac_biet_3" class="form-checkbox chiet_khau_dac_biet">
                        <span class="ml-2">Khách hàng là CBNV ngân hàng tài trợ HOẶC có sổ tiết kiệm/TK ≥ 1 tỷ tại NH tài trợ?</span>
                    </label>
                </div>
                <p class="text-sm text-gray-600 mt-2">Lưu ý: Nếu khách hàng đáp ứng nhiều tiêu chuẩn thì vẫn chỉ áp dụng 1 mức chiết khấu là 2%</p>
            </div>
            
            <!-- 3. Chiết khấu Giao dịch nhiều sản phẩm -->
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2">3. Chiết khấu Giao dịch nhiều sản phẩm</h3>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="chiet_khau_mua_nhieu" id="chiet_khau_mua_nhieu_0" value="0" checked class="form-radio">
                        <span class="ml-2">1 sản phẩm</span>
                    </label>
                </div>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="chiet_khau_mua_nhieu" id="chiet_khau_mua_nhieu_1" value="1" class="form-radio">
                        <span class="ml-2">2 sản phẩm</span>
                    </label>
                </div>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="chiet_khau_mua_nhieu" id="chiet_khau_mua_nhieu_2" value="1.5" class="form-radio">
                        <span class="ml-2">Từ 3 sản phẩm trở lên</span>
                    </label>
                </div>
            </div>
            
            <!-- 4. Voucher ưu đãi -->
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2">4. Voucher ưu đãi</h3>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="voucher_uu_dai" id="voucher_none" value="0" checked class="form-radio">
                        <span class="ml-2">Không sử dụng voucher</span>
                    </label>
                </div>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="voucher_uu_dai" id="voucher_20" value="20" class="form-radio">
                        <span class="ml-2">Voucher 20% - Khách hàng đình danh gốc</span>
                    </label>
                </div>
                <div>
                    <label class="inline-flex items-center mb-2">
                        <input type="radio" name="voucher_uu_dai" id="voucher_18" value="18" class="form-radio">
                        <span class="ml-2">Voucher 18% - Khách hàng nhận chuyển giao</span>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- TÍNH TOÁN GIÁ TRỊ CĂN HỘ -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">TÍNH TOÁN GIÁ TRỊ CĂN HỘ</h2>
            <button id="calculate_btn" class="btn mb-4">Tính toán</button>
            
            <table class="w-full mb-6">
                <tbody>
                    <tr>
                        <td>Tổng giá bán căn hộ (chưa VAT, chưa phí bảo trì):</td>
                        <td id="gia_ban_can_ho_truoc_vat" class="price">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Thuế VAT (<span id="vat_percent_display">10</span>%):</td>
                        <td id="vat_amount" class="price">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Tổng giá bán căn hộ (bao gồm VAT):</td>
                        <td id="tong_gia_ban_can_ho_gom_vat_ban_dau" class="price">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Phí bảo trì (<span id="phi_bao_tri_percent_display">2</span>% trên giá chưa VAT):</td>
                        <td id="phi_bao_tri_amount" class="price">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Tổng chiết khấu chung (<span id="tong_phan_tram_chiet_khau_chung">0</span>%):</td>
                        <td id="tong_tien_chiet_khau_chung" class="price">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Giá bán cuối cùng (bao gồm VAT, sau chiết khấu chung):</td>
                        <td id="gia_ban_cuoi_cung_gom_vat_sau_ck_chung" class="price highlight">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Đơn giá sau chiết khấu chung (VNĐ/m²):</td>
                        <td id="don_gia_sau_ck_chung" class="price highlight">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Voucher ưu đãi (<span id="voucher_percent_display">0</span>%):</td>
                        <td id="voucher_amount" class="price">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Giá bán cuối cùng (sau voucher ưu đãi):</td>
                        <td id="gia_ban_cuoi_cung_sau_voucher" class="price highlight">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Đơn giá sau voucher ưu đãi (VNĐ/m²):</td>
                        <td id="don_gia_sau_voucher" class="price highlight">0 VNĐ</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- THÔNG TIN TÀI CHÍNH KHÁCH HÀNG -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">THÔNG TIN TÀI CHÍNH KHÁCH HÀNG</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="von_tu_co" class="block mb-2 font-medium">Vốn tự có của khách hàng (VNĐ):</label>
                    <input type="number" id="von_tu_co" class="w-full p-2 border rounded" value="1500000000">
                </div>
                <div>
                    <label for="thu_nhap_hang_thang" class="block mb-2 font-medium">Thu nhập hàng tháng của khách hàng (VNĐ):</label>
                    <input type="number" id="thu_nhap_hang_thang" class="w-full p-2 border rounded" value="80000000">
                </div>
            </div>
        </div>
        
        <!-- PHƯƠNG THỨC THANH TOÁN -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">PHƯƠNG THỨC THANH TOÁN</h2>
            
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="openTab('pttt_1')">PTTT 1: Theo thời gian</button>
                <button class="tab-btn" onclick="openTab('pttt_2')">PTTT 2: Theo tiến độ</button>
                <button class="tab-btn" onclick="openTab('pttt_nhanh')">PTTT 3: Nhanh</button>
                <button class="tab-btn" onclick="openTab('pttt_vay')">PTTT 4: Hỗ trợ vay</button>
            </div>
            
            <!-- PTTT 1: THEO THỜI GIAN -->
            <div id="pttt_1" class="tab active">
                <h3 class="text-xl font-bold mb-4">PTTT 1: THANH TOÁN THEO THỜI GIAN (26 ĐỢT)</h3>
                <table class="w-full">
                    <thead>
                        <tr>
                            <th>Đợt thanh toán</th>
                            <th>Tỷ lệ (%)</th>
                            <th>Số tiền (VNĐ)</th>
                            <th>Tiến độ / Thời gian</th>
                            <th>Thời gian</th>
                        </tr>
                    </thead>
                    <tbody id="pttt_1_table">
                        <!-- JS sẽ điền bảng này -->
                    </tbody>
                </table>
            </div>
            
            <!-- PTTT 2: THEO TIẾN ĐỘ -->
            <div id="pttt_2" class="tab">
                <h3 class="text-xl font-bold mb-4">PTTT 2: THANH TOÁN THEO TIẾN ĐỘ XÂY DỰNG (12 ĐỢT)</h3>
                <table class="w-full">
                    <thead>
                        <tr>
                            <th>Đợt thanh toán</th>
                            <th>Tỷ lệ (%)</th>
                            <th>Số tiền (VNĐ)</th>
                            <th>Tiến độ / Thời gian</th>
                            <th>Thời gian</th>
                        </tr>
                    </thead>
                    <tbody id="pttt_2_table">
                        <!-- JS sẽ điền bảng này -->
                    </tbody>
                </table>
            </div>
            
            <!-- PTTT NHANH -->
            <div id="pttt_nhanh" class="tab">
                <h3 class="text-xl font-bold mb-4">PTTT 3: THANH TOÁN NHANH – ƯU ĐÃI "CỰC KHỦNG"</h3>
                <table class="w-full">
                    <thead>
                        <tr>
                            <th>Đợt thanh toán</th>
                            <th>Tỷ lệ (%)</th>
                            <th>Số tiền (VNĐ)</th>
                            <th>Tiến độ / Thời gian</th>
                            <th>Thời gian</th>
                        </tr>
                    </thead>
                    <tbody id="pttt_nhanh_table">
                        <!-- JS sẽ điền bảng này -->
                    </tbody>
                </table>
                
                <div class="mt-4 p-4 bg-blue-100 rounded">
                    <p class="font-medium">Ưu đãi đặc biệt: Chiết khấu 8% cho khoản thanh toán 60% giá trị căn hộ</p>
                    <p>Tổng số tiền được chiết khấu: <span id="chiet_khau_thanh_toan_nhanh_amount" class="font-bold">0 VNĐ</span></p>
                </div>
            </div>
            
            <!-- PTTT VAY -->
            <div id="pttt_vay" class="tab">
                <h3 class="text-xl font-bold mb-4">PTTT 4: HỖ TRỢ VAY ƯU ĐÃI (CHO TỚI KHI BÀN GIAO CHỈ VỚI 8.6%)</h3>
                
                <div class="mb-6">
                    <h4 class="text-lg font-bold mb-2">Thông tin khoản vay</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="lai_suat_vay_uu_dai_nam" class="block mb-2 font-medium">Lãi suất vay ưu đãi (%/năm):</label>
                            <input type="number" id="lai_suat_vay_uu_dai_nam" class="w-full p-2 border rounded" value="0">
                        </div>
                        <div>
                            <label for="thoi_gian_vay_nam" class="block mb-2 font-medium">Thời gian vay (năm):</label>
                            <input type="number" id="thoi_gian_vay_nam" class="w-full p-2 border rounded" value="30">
                        </div>
                        <div>
                            <label for="thoi_gian_ho_tro_lai_suat_thang" class="block mb-2 font-medium">Thời gian hỗ trợ lãi suất (tháng):</label>
                            <input type="number" id="thoi_gian_ho_tro_lai_suat_thang" class="w-full p-2 border rounded" value="24">
                        </div>
                        <div>
                            <label for="thoi_gian_an_han_goc_thang" class="block mb-2 font-medium">Thời gian ân hạn nợ gốc (tháng):</label>
                            <input type="number" id="thoi_gian_an_han_goc_thang" class="w-full p-2 border rounded" value="60">
                        </div>
                    </div>
                </div>
                
                <table class="w-full">
                    <thead>
                        <tr>
                            <th>Đợt thanh toán</th>
                            <th>Tỷ lệ (%)</th>
                            <th>Số tiền (VNĐ)</th>
                            <th>Tiến độ / Thời gian</th>
                            <th>Thời gian</th>
                        </tr>
                    </thead>
                    <tbody id="pttt_vay_table">
                        <!-- JS sẽ điền bảng này -->
                    </tbody>
                </table>
                
                <div class="mt-6">
                    <h4 class="text-lg font-bold mb-2">Thông tin trả góp</h4>
                    <table class="w-full">
                        <tbody id="thong_tin_tra_gop">
                            <!-- JS sẽ điền bảng này -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- BIỂU ĐỒ SO SÁNH -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">BIỂU ĐỒ SO SÁNH DÒNG TIỀN LŨY TIẾN</h2>
            <div style="width: 100%; height: 400px;">
                <canvas id="cashFlowChart"></canvas>
            </div>
            <p class="text-sm text-gray-600 mt-2">Biểu đồ hiển thị tổng số tiền lũy tiến khách hàng phải thanh toán theo thời gian cho từng phương thức</p>
        </div>
        
        <!-- SO SÁNH VÀ KHUYẾN NGHỊ PHƯƠNG THỨC THANH TOÁN -->
        <div class="section">
            <h2 class="text-2xl font-bold mb-4">SO SÁNH VÀ KHUYẾN NGHỊ PHƯƠNG THỨC THANH TOÁN</h2>
            
            <table class="w-full comparison-table">
                <thead>
                    <tr>
                        <th>Tiêu chí</th>
                        <th>PTTT 1: Theo thời gian</th>
                        <th>PTTT 2: Theo tiến độ</th>
                        <th>PTTT 3: Nhanh</th>
                        <th>PTTT 4: Hỗ trợ vay</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Số tiền cọc ban đầu</td>
                        <td id="coc_pttt_1">100.000.000 VNĐ</td>
                        <td id="coc_pttt_2">100.000.000 VNĐ</td>
                        <td id="coc_pttt_nhanh">100.000.000 VNĐ</td>
                        <td id="coc_pttt_vay">100.000.000 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Tổng số tiền cần có để ký HĐMB</td>
                        <td id="ky_hdmb_pttt_1">0 VNĐ</td>
                        <td id="ky_hdmb_pttt_2">0 VNĐ</td>
                        <td id="ky_hdmb_pttt_nhanh">0 VNĐ</td>
                        <td id="ky_hdmb_pttt_vay">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Chiết khấu</td>
                        <td id="chiet_khau_pttt_1">Chiết khấu chung + Voucher</td>
                        <td id="chiet_khau_pttt_2">Chiết khấu chung + Voucher</td>
                        <td id="chiet_khau_pttt_nhanh">Chiết khấu chung + Voucher + 8%</td>
                        <td id="chiet_khau_pttt_vay">Chiết khấu chung + Voucher</td>
                    </tr>
                    <tr>
                        <td>Tổng tiền phải thanh toán tới thời điểm nhận nhà (T+720)</td>
                        <td id="tong_tien_nhan_nha_pttt_1">0 VNĐ</td>
                        <td id="tong_tien_nhan_nha_pttt_2">0 VNĐ</td>
                        <td id="tong_tien_nhan_nha_pttt_nhanh">0 VNĐ</td>
                        <td id="tong_tien_nhan_nha_pttt_vay">0 VNĐ</td>
                    </tr>
                    <tr>
                        <td>Ưu điểm</td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="advantage">Thanh toán theo thời gian đều đặn</li>
                                <li class="advantage">Dễ lập kế hoạch tài chính</li>
                                <li class="advantage">Phù hợp thu nhập ổn định</li>
                            </ul>
                        </td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="advantage">Thanh toán theo tiến độ thực tế</li>
                                <li class="advantage">Giảm rủi ro dự án</li>
                                <li class="advantage">Minh bạch tiến độ</li>
                            </ul>
                        </td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="advantage">Chiết khấu lớn 8%</li>
                                <li class="advantage">Tiết kiệm chi phí tổng</li>
                                <li class="advantage">Thanh toán nhanh</li>
                            </ul>
                        </td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="advantage">Chỉ cần 8.6% đến bàn giao</li>
                                <li class="advantage">Hỗ trợ lãi suất 24 tháng</li>
                                <li class="advantage">Ân hạn nợ gốc</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td>Nhược điểm</td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="disadvantage">Thời gian thanh toán dài</li>
                                <li class="disadvantage">Nhiều đợt thanh toán</li>
                            </ul>
                        </td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="disadvantage">Phụ thuộc tiến độ xây dựng</li>
                                <li class="disadvantage">Khó dự đoán thời gian</li>
                            </ul>
                        </td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="disadvantage">Yêu cầu vốn lớn ban đầu</li>
                                <li class="disadvantage">Áp lực tài chính cao</li>
                            </ul>
                        </td>
                        <td>
                            <ul class="list-disc pl-5">
                                <li class="disadvantage">Chi phí lãi vay dài hạn</li>
                                <li class="disadvantage">Rủi ro lãi suất tăng</li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div id="recommendation" class="recommendation mt-6">
                <h3 class="text-xl font-bold mb-2">Khuyến nghị cho khách hàng:</h3>
                <p id="recommendation_text" class="text-lg">Vui lòng nhập thông tin tài chính và thực hiện tính toán để nhận khuyến nghị phù hợp.</p>
            </div>
        </div>
        
        <div class="mt-6 text-center">
            <p class="text-gray-600">Công cụ tính dòng tiền The Privé - Phiên bản hoàn chỉnh</p>
            <p class="text-gray-600">Đại lý chiến lược OneS | HOTLINE: 090 398 3737</p>
        </div>
    </div>

    <script>
        // Dữ liệu căn hộ
        const apartmentData = {
            // Tháp 5, 6, 7 - Dữ liệu giống nhau
            "5": {
                "01": { "type": "A1-1", "area_wall": 98.50, "area_carpet": 89.70, "direction": "Đông Bắc", "view": "View Bắc: Cao tốc TP.HCM-Long Thành-Dầu Giây, Đường sắt đô thị", "layout_url": "https://i.postimg.cc/R0kStcS3/TW5-6-7-CH-A1-1.jpg", "bedrooms": 3 },
                "02": { "type": "C1-1", "area_wall": 49.80, "area_carpet": 44.70, "direction": "Đông Nam", "view": "View Tây: Sông Giồng Ông Tố, Nút giao An Phú", "layout_url": "https://i.postimg.cc/hvSq8sHG/TW5-6-7-CH-C1-1.jpg", "bedrooms": 1 },
                "03": { "type": "B4-1", "area_wall": 76.30, "area_carpet": 70.20, "direction": "Nam", "view": "View Đông: Cao tốc TP.HCM-Long Thành-Dầu Giây", "layout_url": "https://i.postimg.cc/CKqYwzGw/TW5-6-7-CH-B4-1.jpg", "bedrooms": 2 },
                "04": { "type": "B5-1", "area_wall": 80.60, "area_carpet": 73.30, "direction": "Tây Nam", "view": "View Nam: Sông Giồng Ông Tố, Cầu Phú Mỹ", "layout_url": "https://i.postimg.cc/B6501k7y/TW5-6-7-CH-B5-1.jpg", "bedrooms": 2 },
                "05": { "type": "B6-1", "area_wall": 81.00, "area_carpet": 73.90, "direction": "Tây Nam", "view": "View Nam: Sông Giồng Ông Tố, Cầu Phú Mỹ", "layout_url": "https://i.postimg.cc/mDW4kBjC/TW5-6-7-CH-B6-1.jpg", "bedrooms": 2 },
                "06": { "type": "A2-1", "area_wall": 98.50, "area_carpet": 89.40, "direction": "Tây Bắc", "view": "View Bắc: Cao tốc TP.HCM-Long Thành-Dầu Giây", "layout_url": "https://i.postimg.cc/kGcqLzx8/TW5-6-7-CH-A2-1.jpg", "bedrooms": 3 },
                "07": { "type": "B1-1", "area_wall": 80.90, "area_carpet": 74.90, "direction": "Bắc", "view": "View Tây: Sông Giồng Ông Tố, Nút giao An Phú", "layout_url": "https://i.postimg.cc/DfdvWJtZ/TW5-6-7-CH-B1-1.jpg", "bedrooms": 2 },
                "08": { "type": "B2-1", "area_wall": 88.70, "area_carpet": 80.70, "direction": "Đông Bắc", "view": "View Bắc: Cao tốc TP.HCM-Long Thành-Dầu Giây", "layout_url": "https://i.postimg.cc/jdxsyqbh/TW5-6-7-CH-B2-1.jpg", "bedrooms": 2 },
                "09": { "type": "B3-1", "area_wall": 71.50, "area_carpet": 64.90, "direction": "Đông Bắc", "view": "View Bắc: Cao tốc TP.HCM-Long Thành-Dầu Giây", "layout_url": "https://i.postimg.cc/FzmhWNJN/TW5-6-7-CH-B3-1.jpg", "bedrooms": 2 }
            },
            // Tháp 8 - Dữ liệu chi tiết theo yêu cầu
            "8": {
                "01": { "type": "B3-2", "area_wall": 71.50, "area_carpet": 64.90, "direction": "Chính Bắc (có cửa sổ/ban công phụ hướng Đông)", "view": "View Bắc: Cao tốc TP.HCM-Long Thành-Dầu Giây, Đường sắt đô thị Thủ Thiêm-Long Thành, Khu liên hợp TDTT quốc gia Rạch Chiếc, Các khu đô thị hiện đại. View Đông (phụ): Cao tốc TP.HCM-Long Thành-Dầu Giây, Đường sắt đô thị Thủ Thiêm-Long Thành, Sông Giồng Ông Tố, Các khu đô thị hiện đại", "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-B3-2.jpg", "bedrooms": 2 },
                "02": { "type": "B2-2", "area_wall": 88.70, "area_carpet": 80.70, "direction": "Chính Đông", "view": "View Đông: Cao tốc TP.HCM-Long Thành-Dầu Giây, Đường sắt đô thị Thủ Thiêm-Long Thành, Sông Giồng Ông Tố, Các khu đô thị hiện đại", "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW-8---CH-B2-2.jpg", "bedrooms": 2 },
                "03": { "type": "B1-2", "area_wall": 80.90, "area_carpet": 74.90, "direction": "Chính Đông (có cửa sổ/ban công phụ hướng Nam)", "view": "View Đông: Cao tốc TP.HCM-Long Thành-Dầu Giây, Đường sắt đô thị Thủ Thiêm-Long Thành, Sông Giồng Ông Tố, Các khu đô thị hiện đại. View Nam (phụ): Sông Giồng Ông Tố, Cầu Phú Mỹ, Cảng Cát Lái, Cầu Cát Lái", "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-B1-2.jpg", "bedrooms": 2 },
                "04": { "type": "A2a-2", "area_wall": 98.50, "area_carpet": 89.40, "direction": "Chính Nam (có cửa sổ/ban công phụ hướng Đông)", "view": "View Nam: Sông Giồng Ông Tố, Cầu Phú Mỹ, Cảng Cát Lái, Cầu Cát Lái. View Đông (phụ): Cao tốc TP.HCM-Long Thành-Dầu Giây, Đường sắt đô thị Thủ Thiêm-Long Thành, Sông Giồng Ông Tố, Các khu đô thị hiện đại", "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-A2-2.jpg", "bedrooms": 3 },
                "05": { "type": "B6-2", "area_wall": 81.00, "area_carpet": 73.90, "direction": "Chính Nam", "view": "View Nam: Sông Giồng Ông Tố, Cầu Phú Mỹ, Cảng Cát Lái, Cầu Cát Lái", "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW-8---CH-B6-2.jpg", "bedrooms": 2 },
                "06": { "type": "B5-2", "area_wall": 80.60, "area_carpet": 73.30, "direction": "Chính Tây (có cửa sổ/ban công phụ hướng Nam)", "view": "View Tây: Sông Giồng Ông Tố, Nút giao An Phú, Ga Thủ Thiêm, Landmark 81. View Nam (phụ): Sông Giồng Ông Tố, Cầu Phú Mỹ, Cảng Cát Lái, Cầu Cát Lái", "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-B5-2.jpg", "bedrooms": 2 },
                "07": { "type": "B4-2", "area_wall": 76.30, "area_carpet": 70.20, "direction": "Chính Tây", "view": "View Tây: Sông Giồng Ông Tố, Nút giao An Phú, Ga Thủ Thiêm, Landmark 81", "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-B4-2.jpg", "bedrooms": 2 },
                "08": { "type": "C1-2", "area_wall": 49.80, "area_carpet": 44.70, "direction": "Chính Tây", "view": "View Tây: Sông Giồng Ông Tố, Nút giao An Phú, Ga Thủ Thiêm, Landmark 81", "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-C1-2.jpg", "bedrooms": 1 },
                "09": { "type": "A1-2", "area_wall": 98.50, "area_carpet": 89.70, "direction": "Chính Bắc (có cửa sổ/ban công phụ hướng Tây)", "view": "View Bắc: Cao tốc TP.HCM-Long Thành-Dầu Giây, Đường sắt đô thị Thủ Thiêm-Long Thành, Khu liên hợp TDTT quốc gia Rạch Chiếc, Các khu đô thị hiện đại. View Tây (phụ): Sông Giồng Ông Tố, Nút giao An Phú, Ga Thủ Thiêm, Landmark 81", "layout_url": "https://sv1.anhsieuviet.com/2025/05/23/TW8---CH-A1-2.jpg", "bedrooms": 3 }
            }
        };

        // Copy dữ liệu tháp 5 cho tháp 6 và 7
        apartmentData["6"] = JSON.parse(JSON.stringify(apartmentData["5"]));
        apartmentData["7"] = JSON.parse(JSON.stringify(apartmentData["5"]));

        // Biến toàn cục
        let cashFlowChart = null;
        let currentCalculationData = {};

        // Khởi tạo
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateFloorOptions();
        });

        function setupEventListeners() {
            document.getElementById('tower').addEventListener('change', updateApartmentOptions);
            document.getElementById('apartment_code').addEventListener('change', updateFloorOptions);
            document.getElementById('floor').addEventListener('change', updateApartmentInfo);
            document.getElementById('calculate_btn').addEventListener('click', calculateAll);

            // Tự động tính toán khi thay đổi thông tin
            const autoCalculateInputs = ['gia_m2', 'vat_percent', 'phi_bao_tri_percent', 'von_tu_co', 'thu_nhap_hang_thang'];
            autoCalculateInputs.forEach(id => {
                document.getElementById(id).addEventListener('input', calculateAll);
            });

            // Tự động tính toán khi thay đổi ưu đãi
            document.getElementById('chiet_khau_nguyen_vong').addEventListener('change', calculateAll);
            document.querySelectorAll('.chiet_khau_dac_biet').forEach(el => {
                el.addEventListener('change', calculateAll);
            });
            document.querySelectorAll('input[name="chiet_khau_mua_nhieu"]').forEach(el => {
                el.addEventListener('change', calculateAll);
            });
            document.querySelectorAll('input[name="voucher_uu_dai"]').forEach(el => {
                el.addEventListener('change', calculateAll);
            });
        }

        function updateApartmentOptions() {
            const tower = document.getElementById('tower').value;
            const apartmentSelect = document.getElementById('apartment_code');
            
            apartmentSelect.innerHTML = '<option value="">Chọn mã căn hộ</option>';
            
            if (tower && apartmentData[tower]) {
                apartmentSelect.disabled = false;
                Object.keys(apartmentData[tower]).forEach(code => {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = `Căn ${code}`;
                    apartmentSelect.appendChild(option);
                });
            } else {
                apartmentSelect.disabled = true;
                document.getElementById('floor').disabled = true;
            }
            
            updateFloorPlan();
            clearApartmentInfo();
        }

        function updateFloorOptions() {
            const tower = document.getElementById('tower').value;
            const apartmentCode = document.getElementById('apartment_code').value;
            const floorSelect = document.getElementById('floor');
            
            floorSelect.innerHTML = '<option value="">Chọn tầng</option>';
            
            if (tower && apartmentCode) {
                floorSelect.disabled = false;
                
                // Tầng 4-31, nhưng tháp 8 căn 05 tầng 20,21 là GLN
                for (let i = 4; i <= 31; i++) {
                    if (tower === '8' && apartmentCode === '05' && (i === 20 || i === 21)) {
                        continue; // Bỏ qua tầng 20,21 cho căn 05 tháp 8 (GLN)
                    }
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Tầng ${i}`;
                    floorSelect.appendChild(option);
                }
            } else {
                floorSelect.disabled = true;
            }
            
            clearApartmentInfo();
        }

        function updateFloorPlan() {
            const tower = document.getElementById('tower').value;
            const floor = document.getElementById('floor').value;
            const floorPlanImg = document.getElementById('mat_bang_tang');
            
            if (tower === '8') {
                // Tháp 8 có mặt bằng riêng
                if (floor === '20') {
                    floorPlanImg.src = 'https://sv1.anhsieuviet.com/2025/05/23/TANG-20_TW8.png';
                } else if (floor === '21') {
                    floorPlanImg.src = 'https://sv1.anhsieuviet.com/2025/05/23/TANG-21_TW8.png';
                } else {
                    floorPlanImg.src = 'https://sv1.anhsieuviet.com/2025/05/23/TANG-DIEN-HINH_TW8.png';
                }
            } else {
                // Tháp 5,6,7
                if (floor === '20') {
                    floorPlanImg.src = 'https://i.postimg.cc/Gh4SqBrq/MB-TANG-20-THAP-5-6-7.png';
                } else if (floor === '21') {
                    floorPlanImg.src = 'https://i.postimg.cc/TYBNSR3G/MB-TANG-21-THAP-5-6-7.png';
                } else {
                    floorPlanImg.src = 'https://i.postimg.cc/52vKWZXz/MB-TANG-DIEN-HINH-THAP-5-6-7.png';
                }
            }
        }

        function updateApartmentInfo() {
            const tower = document.getElementById('tower').value;
            const apartmentCode = document.getElementById('apartment_code').value;
            const floor = document.getElementById('floor').value;
            
            if (tower && apartmentCode && floor && apartmentData[tower] && apartmentData[tower][apartmentCode]) {
                const apartment = apartmentData[tower][apartmentCode];
                
                // Cập nhật mặt bằng tầng
                updateFloorPlan();
                
                // Cập nhật thông tin căn hộ
                document.getElementById('ma_can_ho').value = `T${tower}.${apartmentCode}.${floor}`;
                document.getElementById('dien_tich_tim_tuong').value = apartment.area_wall;
                document.getElementById('dien_tich_thong_thuy').value = apartment.area_carpet;
                document.getElementById('huong_can').value = apartment.direction;
                document.getElementById('view_can').value = apartment.view;
                document.getElementById('loai_can_ho').value = `${apartment.bedrooms} Phòng ngủ (${apartment.type})`;
                
                // Hiển thị layout căn hộ
                const layoutImg = document.getElementById('layout_image');
                layoutImg.src = apartment.layout_url;
                layoutImg.classList.remove('hidden');
                
                // Tự động tính toán
                calculateAll();
            }
        }

        function clearApartmentInfo() {
            document.getElementById('ma_can_ho').value = '';
            document.getElementById('dien_tich_tim_tuong').value = '';
            document.getElementById('dien_tich_thong_thuy').value = '';
            document.getElementById('huong_can').value = '';
            document.getElementById('view_can').value = '';
            document.getElementById('loai_can_ho').value = '';
            
            const layoutImg = document.getElementById('layout_image');
            layoutImg.classList.add('hidden');
        }

        function calculateAll() {
            const gia_m2 = parseFloat(document.getElementById('gia_m2').value) || 0;
            const dien_tich_tim_tuong = parseFloat(document.getElementById('dien_tich_tim_tuong').value) || 0;
            
            if (gia_m2 === 0 || dien_tich_tim_tuong === 0) {
                return;
            }
            
            // Tính giá bán cơ bản
            const gia_ban_can_ho_truoc_vat = gia_m2 * dien_tich_tim_tuong;
            const vat_percent = parseFloat(document.getElementById('vat_percent').value) || 10;
            const vat_amount = gia_ban_can_ho_truoc_vat * (vat_percent / 100);
            const tong_gia_ban_can_ho_gom_vat_ban_dau = gia_ban_can_ho_truoc_vat + vat_amount;
            
            // Tính phí bảo trì
            const phi_bao_tri_percent = parseFloat(document.getElementById('phi_bao_tri_percent').value) || 2;
            const phi_bao_tri_amount = gia_ban_can_ho_truoc_vat * (phi_bao_tri_percent / 100);
            
            // Tính chiết khấu chung
            let chiet_khau_nguyen_vong_percent = document.getElementById('chiet_khau_nguyen_vong').checked ? 3 : 0;
            
            let chiet_khau_dac_biet_percent = 0;
            const dacBietChecked = document.querySelectorAll('.chiet_khau_dac_biet:checked');
            if (dacBietChecked.length > 0) {
                chiet_khau_dac_biet_percent = 2;
            }
            
            const chiet_khau_mua_nhieu_percent = parseFloat(document.querySelector('input[name="chiet_khau_mua_nhieu"]:checked').value) || 0;
            
            const tong_phan_tram_chiet_khau_chung = chiet_khau_nguyen_vong_percent + chiet_khau_dac_biet_percent + chiet_khau_mua_nhieu_percent;
            const tong_tien_chiet_khau_chung = tong_gia_ban_can_ho_gom_vat_ban_dau * (tong_phan_tram_chiet_khau_chung / 100);
            const gia_ban_cuoi_cung_gom_vat_sau_ck_chung = tong_gia_ban_can_ho_gom_vat_ban_dau - tong_tien_chiet_khau_chung;
            
            // CHÍNH XÁC: Đơn giá sau chiết khấu chung = Giá bán cuối cùng (bao gồm VAT, sau chiết khấu chung) / Diện tích tim tường
            const don_gia_sau_ck_chung = gia_ban_cuoi_cung_gom_vat_sau_ck_chung / dien_tich_tim_tuong;
            
            // Tính voucher ưu đãi
            const voucher_percent = parseFloat(document.querySelector('input[name="voucher_uu_dai"]:checked').value) || 0;
            const voucher_amount = gia_ban_cuoi_cung_gom_vat_sau_ck_chung * (voucher_percent / 100);
            const gia_ban_cuoi_cung_sau_voucher = gia_ban_cuoi_cung_gom_vat_sau_ck_chung - voucher_amount;
            const don_gia_sau_voucher = gia_ban_cuoi_cung_sau_voucher / dien_tich_tim_tuong;
            
            // Cập nhật hiển thị
            document.getElementById('gia_ban_can_ho_truoc_vat').textContent = formatCurrency(gia_ban_can_ho_truoc_vat);
            document.getElementById('vat_percent_display').textContent = vat_percent;
            document.getElementById('vat_amount').textContent = formatCurrency(vat_amount);
            document.getElementById('tong_gia_ban_can_ho_gom_vat_ban_dau').textContent = formatCurrency(tong_gia_ban_can_ho_gom_vat_ban_dau);
            document.getElementById('phi_bao_tri_percent_display').textContent = phi_bao_tri_percent;
            document.getElementById('phi_bao_tri_amount').textContent = formatCurrency(phi_bao_tri_amount);
            document.getElementById('tong_phan_tram_chiet_khau_chung').textContent = tong_phan_tram_chiet_khau_chung;
            document.getElementById('tong_tien_chiet_khau_chung').textContent = formatCurrency(tong_tien_chiet_khau_chung);
            document.getElementById('gia_ban_cuoi_cung_gom_vat_sau_ck_chung').textContent = formatCurrency(gia_ban_cuoi_cung_gom_vat_sau_ck_chung);
            document.getElementById('don_gia_sau_ck_chung').textContent = formatCurrency(don_gia_sau_ck_chung);
            document.getElementById('voucher_percent_display').textContent = voucher_percent;
            document.getElementById('voucher_amount').textContent = formatCurrency(voucher_amount);
            document.getElementById('gia_ban_cuoi_cung_sau_voucher').textContent = formatCurrency(gia_ban_cuoi_cung_sau_voucher);
            document.getElementById('don_gia_sau_voucher').textContent = formatCurrency(don_gia_sau_voucher);
            
            // Lưu dữ liệu để sử dụng cho các phương thức thanh toán
            currentCalculationData = {
                gia_ban_cuoi_cung: voucher_amount > 0 ? gia_ban_cuoi_cung_sau_voucher : gia_ban_cuoi_cung_gom_vat_sau_ck_chung,
                phi_bao_tri_amount: phi_bao_tri_amount,
                tong_tien_chiet_khau_chung: tong_tien_chiet_khau_chung,
                voucher_amount: voucher_amount
            };
            
            // Tính toán các phương thức thanh toán
            calculatePaymentMethods();
            updateComparisonTable();
            updateRecommendation();
            updateCashFlowChart();
        }

        function calculatePaymentMethods() {
            const gia_ban = currentCalculationData.gia_ban_cuoi_cung;
            const phi_bao_tri = currentCalculationData.phi_bao_tri_amount;
            
            // PTTT 1: Theo thời gian (26 đợt)
            calculatePTTT1(gia_ban, phi_bao_tri);
            
            // PTTT 2: Theo tiến độ (12 đợt)
            calculatePTTT2(gia_ban, phi_bao_tri);
            
            // PTTT 3: Nhanh
            calculatePTTTNhanh(gia_ban, phi_bao_tri);
            
            // PTTT 4: Hỗ trợ vay
            calculatePTTTVay(gia_ban, phi_bao_tri);
        }

        function calculatePTTT1(gia_ban, phi_bao_tri) {
            const tableBody = document.getElementById('pttt_1_table');
            tableBody.innerHTML = '';
            
            const tien_dat_coc = 100000000;
            
            // Đợt 1: Ký HĐMB - 10%
            const dot_1 = gia_ban * 0.10;
            const dot_1_thuc_dong = Math.max(0, dot_1 - tien_dat_coc);
            addPaymentRow(tableBody, 'Đặt cọc', '', formatCurrency(tien_dat_coc), 'Trước khi ký HĐMB', 'T-30');
            addPaymentRow(tableBody, 'Đợt 1 - Ký HĐMB', '10%', formatCurrency(dot_1_thuc_dong), 'Ký Hợp đồng mua bán', 'T');
            
            // Đợt 2: 5%
            const dot_2 = gia_ban * 0.05;
            addPaymentRow(tableBody, 'Đợt 2', '5%', formatCurrency(dot_2), 'Trong vòng 30 ngày kể từ ngày ký HĐMB', 'T+30');
            
            // Đợt 3-16: 2% mỗi đợt (14 đợt)
            for (let i = 3; i <= 16; i++) {
                const amount = gia_ban * 0.02;
                const days = 30 + (i - 2) * 30;
                addPaymentRow(tableBody, `Đợt ${i}`, '2%', formatCurrency(amount), `Trong vòng 30 ngày kể từ ngày đến hạn thanh toán Đợt ${i-1}`, `T+${days}`);
            }
            
            // Đợt 17-24: 3% mỗi đợt (8 đợt)
            for (let i = 17; i <= 24; i++) {
                const amount = gia_ban * 0.03;
                const days = 30 + (i - 2) * 30;
                addPaymentRow(tableBody, `Đợt ${i}`, '3%', formatCurrency(amount), `Trong vòng 30 ngày kể từ ngày đến hạn thanh toán Đợt ${i-1}`, `T+${days}`);
            }
            
            // Đợt 25: Bàn giao - 25%
            const dot_25 = gia_ban * 0.25;
            addPaymentRow(tableBody, 'Đợt 25 - Bàn giao', '25%', formatCurrency(dot_25), 'Thông báo bàn giao căn hộ/căn thương mại dịch vụ', 'T+720');
            
            // Đợt 26: Nhận GCN - 5%
            const dot_26 = gia_ban * 0.05;
            addPaymentRow(tableBody, 'Đợt 26 - Nhận GCN', '5%', formatCurrency(dot_26), 'Thông báo nhận Giấy Chứng Nhận Quyền Sở Hữu', 'T+750');
            
            // Phí bảo trì
            addPaymentRow(tableBody, 'Phí bảo trì', '2%', formatCurrency(phi_bao_tri), 'Khi nhận bàn giao', 'T+720');
        }

        function calculatePTTT2(gia_ban, phi_bao_tri) {
            const tableBody = document.getElementById('pttt_2_table');
            tableBody.innerHTML = '';
            
            const tien_dat_coc = 100000000;
            
            // Đợt 1: Ký HĐMB - 10%
            const dot_1 = gia_ban * 0.10;
            const dot_1_thuc_dong = Math.max(0, dot_1 - tien_dat_coc);
            addPaymentRow(tableBody, 'Đặt cọc', '', formatCurrency(tien_dat_coc), 'Trước khi ký HĐMB', 'T-30');
            addPaymentRow(tableBody, 'Đợt 1 - Ký HĐMB', '10%', formatCurrency(dot_1_thuc_dong), 'Ký Hợp đồng mua bán', 'T');
            
            // Đợt 2: Dỡ bỏ tổng vách hầm - 10%
            const dot_2 = gia_ban * 0.10;
            addPaymentRow(tableBody, 'Đợt 2', '10%', formatCurrency(dot_2), 'Khi công trình được dỡ bỏ tổng vách hầm', 'T+60');
            
            // Đợt 3-9: Hoàn thành sàn tầng - 6% mỗi đợt
            const tangData = [
                {tang: 1, time: 'T+120'},
                {tang: 5, time: 'T+180'},
                {tang: 10, time: 'T+240'},
                {tang: 15, time: 'T+360'},
                {tang: 20, time: 'T+480'},
                {tang: 25, time: 'T+600'},
                {tang: 30, time: 'T+660'}
            ];
            
            tangData.forEach((data, index) => {
                const dotNumber = index + 3;
                const amount = gia_ban * 0.06;
                addPaymentRow(tableBody, `Đợt ${dotNumber}`, '6%', formatCurrency(amount), `Khi công trình được dỡ bỏ tổng sàn tầng ${data.tang}`, data.time);
            });
            
            // Đợt 10: Cất nóc - 8%
            const dot_10 = gia_ban * 0.08;
            addPaymentRow(tableBody, 'Đợt 10', '8%', formatCurrency(dot_10), 'Khi công trình được dỡ bỏ tổng tầng mái (cất nóc)', 'T+690');
            
            // Đợt 11: Bàn giao - 25%
            const dot_11 = gia_ban * 0.25;
            addPaymentRow(tableBody, 'Đợt 11 - Bàn giao', '25%', formatCurrency(dot_11), 'Thông báo bàn giao căn hộ/căn thương mại dịch vụ', 'T+720');
            
            // Đợt 12: Nhận GCN - 5%
            const dot_12 = gia_ban * 0.05;
            addPaymentRow(tableBody, 'Đợt 12 - Nhận GCN', '5%', formatCurrency(dot_12), 'Thông báo nhận Giấy Chứng Nhận Quyền Sở Hữu', 'T+750');
            
            // Phí bảo trì
            addPaymentRow(tableBody, 'Phí bảo trì', '2%', formatCurrency(phi_bao_tri), 'Khi nhận bàn giao', 'T+720');
        }

        function calculatePTTTNhanh(gia_ban, phi_bao_tri) {
            const tableBody = document.getElementById('pttt_nhanh_table');
            tableBody.innerHTML = '';
            
            const tien_dat_coc = 100000000;
            
            // Đợt 1: Ký HĐMB - 10%
            const dot_1 = gia_ban * 0.10;
            const dot_1_thuc_dong = Math.max(0, dot_1 - tien_dat_coc);
            addPaymentRow(tableBody, 'Đặt cọc', '', formatCurrency(tien_dat_coc), 'Trước khi ký HĐMB', 'T-30');
            addPaymentRow(tableBody, 'Đợt 1 - Ký HĐMB', '10%', formatCurrency(dot_1_thuc_dong), 'Ký Hợp đồng mua bán', 'T');
            
            // Đợt 2: Thanh toán 60% - Có chiết khấu 8%
            const dot_2_goc = gia_ban * 0.60;
            const chiet_khau_8_percent = dot_2_goc * 0.08;
            const dot_2_thuc_dong = dot_2_goc - chiet_khau_8_percent;
            addPaymentRow(tableBody, 'Đợt 2 - Thanh toán nhanh', '60%', formatCurrency(dot_2_thuc_dong), 'Trong vòng 30 ngày kể từ ngày ký HĐMB (Được CK 8%)', 'T+30');
            
            // Đợt 3: Bàn giao - 25%
            const dot_3 = gia_ban * 0.25;
            addPaymentRow(tableBody, 'Đợt 3 - Bàn giao', '25%', formatCurrency(dot_3), 'Thông báo bàn giao căn hộ', 'T+720');
            
            // Đợt 4: Nhận GCN - 5%
            const dot_4 = gia_ban * 0.05;
            addPaymentRow(tableBody, 'Đợt 4 - Nhận GCN', '5%', formatCurrency(dot_4), 'Thông báo nhận Giấy Chứng Nhận', 'T+750');
            
            // Phí bảo trì
            addPaymentRow(tableBody, 'Phí bảo trì', '2%', formatCurrency(phi_bao_tri), 'Khi nhận bàn giao', 'T+720');
            
            // Cập nhật số tiền chiết khấu
            document.getElementById('chiet_khau_thanh_toan_nhanh_amount').textContent = formatCurrency(chiet_khau_8_percent);
        }

        function calculatePTTTVay(gia_ban, phi_bao_tri) {
            const tableBody = document.getElementById('pttt_vay_table');
            tableBody.innerHTML = '';
            
            const tien_dat_coc = 100000000;
            
            // Đợt 1: Vốn tự có - 8.6%
            const dot_1_vtc = gia_ban * 0.086;
            const dot_1_thuc_dong = Math.max(0, dot_1_vtc - tien_dat_coc);
            addPaymentRow(tableBody, 'Đặt cọc', '', formatCurrency(tien_dat_coc), 'Trước khi ký HĐMB', 'T-30');
            addPaymentRow(tableBody, 'Đợt 1 - Vốn tự có', '8.6%', formatCurrency(dot_1_thuc_dong), 'Ký Hợp đồng mua bán', 'T');
            
            // Ngân hàng giải ngân - 61.4%
            const ngan_hang_1 = gia_ban * 0.614;
            addPaymentRow(tableBody, 'Ngân hàng giải ngân đợt 1', '61.4%', formatCurrency(ngan_hang_1), 'Khi ký HĐMB (Ngân hàng chi trả)', 'T');
            
            // Bàn giao - Khách thanh toán 16.4%
            const ban_giao_khach = gia_ban * 0.164;
            addPaymentRow(tableBody, 'Bàn giao - Khách thanh toán', '16.4%', formatCurrency(ban_giao_khach), 'Thông báo bàn giao căn hộ', 'T+720');
            
            // Bàn giao - Ngân hàng thanh toán 8.6%
            const ban_giao_ngan_hang = gia_ban * 0.086;
            addPaymentRow(tableBody, 'Bàn giao - Ngân hàng thanh toán', '8.6%', formatCurrency(ban_giao_ngan_hang), 'Thông báo bàn giao căn hộ (Ngân hàng chi trả)', 'T+720');
            
            // Nhận GCN - 5%
            const nhan_gcn = gia_ban * 0.05;
            addPaymentRow(tableBody, 'Nhận GCN', '5%', formatCurrency(nhan_gcn), 'Thông báo nhận Giấy Chứng Nhận', 'T+750');
            
            // Phí bảo trì
            addPaymentRow(tableBody, 'Phí bảo trì', '2%', formatCurrency(phi_bao_tri), 'Khi nhận bàn giao', 'T+720');
            
            // Tính toán thông tin trả góp
            calculateLoanInfo(ngan_hang_1 + ban_giao_ngan_hang);
        }

        function calculateLoanInfo(loan_amount) {
            const lai_suat_uu_dai = parseFloat(document.getElementById('lai_suat_vay_uu_dai_nam').value) || 0;
            const thoi_gian_vay = parseFloat(document.getElementById('thoi_gian_vay_nam').value) || 30;
            const thoi_gian_ho_tro = parseFloat(document.getElementById('thoi_gian_ho_tro_lai_suat_thang').value) || 24;
            const thoi_gian_an_han = parseFloat(document.getElementById('thoi_gian_an_han_goc_thang').value) || 60;
            
            const tableBody = document.getElementById('thong_tin_tra_gop');
            tableBody.innerHTML = '';
            
            // Trong thời gian hỗ trợ lãi suất (24 tháng đầu)
            const tra_lai_uu_dai = loan_amount * (lai_suat_uu_dai / 100 / 12);
            addLoanInfoRow(tableBody, 'Trả lãi hàng tháng trong thời gian được hỗ trợ lãi suất (24 tháng đầu)', formatCurrency(tra_lai_uu_dai));
            
            // Trả lãi trong thời gian ân hạn gốc (từ tháng 25 đến tháng 60)
            const lai_suat_tha_noi = 12; // Giả định lãi suất thả nổi
            const tra_lai_an_han = loan_amount * (lai_suat_tha_noi / 100 / 12);
            addLoanInfoRow(tableBody, 'Trả lãi hàng tháng trong thời gian ân hạn gốc (từ tháng 25 đến tháng 60)', formatCurrency(tra_lai_an_han));
            
            // Trả gốc + lãi sau thời gian ân hạn
            const thang_con_lai = (thoi_gian_vay * 12) - thoi_gian_an_han;
            const monthly_payment = calculatePMT(lai_suat_tha_noi / 100 / 12, thang_con_lai, loan_amount);
            addLoanInfoRow(tableBody, `Trả gốc + lãi hàng tháng sau thời gian ân hạn (từ tháng 61 đến tháng ${thoi_gian_vay * 12})`, formatCurrency(monthly_payment));
            
            // Tổng số tiền phải trả trong thời gian được hỗ trợ lãi suất
            const tong_ho_tro_lai_suat = tra_lai_uu_dai * thoi_gian_ho_tro;
            addLoanInfoRow(tableBody, 'Tổng số tiền phải trả trong thời gian được hỗ trợ lãi suất (24 tháng)', formatCurrency(tong_ho_tro_lai_suat));
        }

        function calculatePMT(rate, nper, pv) {
            if (rate === 0) return pv / nper;
            return pv * rate * Math.pow(1 + rate, nper) / (Math.pow(1 + rate, nper) - 1);
        }

        function addPaymentRow(tableBody, dot, ty_le, so_tien, tien_do, thoi_gian) {
            const row = tableBody.insertRow();
            row.insertCell(0).textContent = dot;
            row.insertCell(1).textContent = ty_le;
            row.insertCell(2).textContent = so_tien;
            row.insertCell(3).textContent = tien_do;
            row.insertCell(4).textContent = thoi_gian;
        }

        function addLoanInfoRow(tableBody, label, value) {
            const row = tableBody.insertRow();
            row.insertCell(0).textContent = label;
            row.insertCell(1).textContent = value;
        }

        function updateComparisonTable() {
            const gia_ban = currentCalculationData.gia_ban_cuoi_cung;
            
            // Tính toán tổng tiền cần để ký HĐMB
            const tien_coc = 100000000;
            const dot_1_percent = 0.10;
            const ky_hdmb_amount = gia_ban * dot_1_percent;
            
            // PTTT 1
            document.getElementById('ky_hdmb_pttt_1').textContent = formatCurrency(ky_hdmb_amount);
            
            // PTTT 2
            document.getElementById('ky_hdmb_pttt_2').textContent = formatCurrency(ky_hdmb_amount);
            
            // PTTT 3
            document.getElementById('ky_hdmb_pttt_nhanh').textContent = formatCurrency(ky_hdmb_amount);
            
            // PTTT 4
            document.getElementById('ky_hdmb_pttt_vay').textContent = formatCurrency(gia_ban * 0.086);
            
            // Tính tổng tiền đến thời điểm nhận nhà (T+720)
            const pttt1_den_nhan_nha = gia_ban * 0.70; // 70% đến bàn giao
            const pttt2_den_nhan_nha = gia_ban * 0.75; // 75% đến bàn giao
            const pttt3_den_nhan_nha = gia_ban * 0.95 - (gia_ban * 0.60 * 0.08); // 95% - chiết khấu 8%
            const pttt4_den_nhan_nha = gia_ban * (0.086 + 0.164); // VTC + khách thanh toán
            
            document.getElementById('tong_tien_nhan_nha_pttt_1').textContent = formatCurrency(pttt1_den_nhan_nha);
            document.getElementById('tong_tien_nhan_nha_pttt_2').textContent = formatCurrency(pttt2_den_nhan_nha);
            document.getElementById('tong_tien_nhan_nha_pttt_nhanh').textContent = formatCurrency(pttt3_den_nhan_nha);
            document.getElementById('tong_tien_nhan_nha_pttt_vay').textContent = formatCurrency(pttt4_den_nhan_nha);
        }

        function updateRecommendation() {
            const von_tu_co = parseFloat(document.getElementById('von_tu_co').value) || 0;
            const thu_nhap = parseFloat(document.getElementById('thu_nhap_hang_thang').value) || 0;
            const gia_ban = currentCalculationData.gia_ban_cuoi_cung;
            
            let recommendation = '';
            
            if (von_tu_co >= gia_ban * 0.70) {
                recommendation = 'Với vốn tự có hiện tại, bạn có thể lựa chọn PTTT 3 (Thanh toán nhanh) để được chiết khấu 8% cho khoản thanh toán 60%, giúp tiết kiệm chi phí đáng kể.';
            } else if (von_tu_co >= gia_ban * 0.25 && thu_nhap * 12 >= gia_ban * 0.30) {
                recommendation = 'Với khả năng tài chính hiện tại, PTTT 1 (Theo thời gian) hoặc PTTT 2 (Theo tiến độ) sẽ phù hợp, giúp bạn phân bổ thanh toán đều đặn theo thời gian.';
            } else if (von_tu_co >= gia_ban * 0.086) {
                recommendation = 'PTTT 4 (Hỗ trợ vay ưu đãi) sẽ phù hợp với bạn, chỉ cần 8.6% vốn tự có đến khi bàn giao và được hỗ trợ lãi suất trong 24 tháng đầu.';
            } else {
                recommendation = 'Bạn nên cân nhắc tăng vốn tự có hoặc tìm hiểu thêm về các chương trình hỗ trợ tài chính để có thể lựa chọn phương thức thanh toán phù hợp.';
            }
            
            document.getElementById('recommendation_text').textContent = recommendation;
        }

        function updateCashFlowChart() {
            const ctx = document.getElementById('cashFlowChart').getContext('2d');
            
            if (cashFlowChart) {
                cashFlowChart.destroy();
            }
            
            const gia_ban = currentCalculationData.gia_ban_cuoi_cung;
            const datasets = [];
            
            // PTTT 1: Theo thời gian
            const pttt1Data = calculateCumulativePayments1(gia_ban);
            datasets.push({
                label: 'PTTT 1: Theo thời gian',
                data: pttt1Data,
                borderColor: 'rgb(34, 197, 94)',
                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                tension: 0.1
            });
            
            // PTTT 2: Theo tiến độ
            const pttt2Data = calculateCumulativePayments2(gia_ban);
            datasets.push({
                label: 'PTTT 2: Theo tiến độ',
                data: pttt2Data,
                borderColor: 'rgb(249, 115, 22)',
                backgroundColor: 'rgba(249, 115, 22, 0.1)',
                tension: 0.1
            });
            
            // PTTT 3: Nhanh
            const pttt3Data = calculateCumulativePayments3(gia_ban);
            datasets.push({
                label: 'PTTT 3: Nhanh',
                data: pttt3Data,
                borderColor: 'rgb(239, 68, 68)',
                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                tension: 0.1
            });
            
            // PTTT 4: Hỗ trợ vay
            const pttt4Data = calculateCumulativePayments4(gia_ban);
            datasets.push({
                label: 'PTTT 4: Hỗ trợ vay',
                data: pttt4Data,
                borderColor: 'rgb(59, 130, 246)',
                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                tension: 0.1
            });
            
            cashFlowChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Thời gian (ngày)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Số tiền lũy tiến (VNĐ)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatCurrencyShort(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    }
                }
            });
        }

        function calculateCumulativePayments1(gia_ban) {
            const data = [];
            const tien_coc = 100000000;
            let cumulative = 0;
            
            // Đặt cọc T-30
            data.push({x: -30, y: cumulative});
            cumulative += tien_coc;
            data.push({x: -30, y: cumulative});
            
            // Đợt 1: T
            cumulative += Math.max(0, gia_ban * 0.10 - tien_coc);
            data.push({x: 0, y: cumulative});
            
            // Đợt 2: T+30
            cumulative += gia_ban * 0.05;
            data.push({x: 30, y: cumulative});
            
            // Đợt 3-16: 2% mỗi đợt
            for (let i = 3; i <= 16; i++) {
                const days = 30 + (i - 2) * 30;
                cumulative += gia_ban * 0.02;
                data.push({x: days, y: cumulative});
            }
            
            // Đợt 17-24: 3% mỗi đợt
            for (let i = 17; i <= 24; i++) {
                const days = 30 + (i - 2) * 30;
                cumulative += gia_ban * 0.03;
                data.push({x: days, y: cumulative});
            }
            
            // Đợt 25: T+720 (Bàn giao)
            cumulative += gia_ban * 0.25;
            cumulative += currentCalculationData.phi_bao_tri_amount; // Phí bảo trì
            data.push({x: 720, y: cumulative});
            
            // Đợt 26: T+750 (GCN)
            cumulative += gia_ban * 0.05;
            data.push({x: 750, y: cumulative});
            
            return data;
        }

        function calculateCumulativePayments2(gia_ban) {
            const data = [];
            const tien_coc = 100000000;
            let cumulative = 0;
            
            // Đặt cọc T-30
            data.push({x: -30, y: cumulative});
            cumulative += tien_coc;
            data.push({x: -30, y: cumulative});
            
            // Đợt 1: T
            cumulative += Math.max(0, gia_ban * 0.10 - tien_coc);
            data.push({x: 0, y: cumulative});
            
            // Đợt 2: T+60
            cumulative += gia_ban * 0.10;
            data.push({x: 60, y: cumulative});
            
            // Đợt 3-9: 6% mỗi đợt theo tiến độ
            const schedule = [120, 180, 240, 360, 480, 600, 660];
            schedule.forEach(days => {
                cumulative += gia_ban * 0.06;
                data.push({x: days, y: cumulative});
            });
            
            // Đợt 10: T+690 (Cất nóc)
            cumulative += gia_ban * 0.08;
            data.push({x: 690, y: cumulative});
            
            // Đợt 11: T+720 (Bàn giao)
            cumulative += gia_ban * 0.25;
            cumulative += currentCalculationData.phi_bao_tri_amount; // Phí bảo trì
            data.push({x: 720, y: cumulative});
            
            // Đợt 12: T+750 (GCN)
            cumulative += gia_ban * 0.05;
            data.push({x: 750, y: cumulative});
            
            return data;
        }

        function calculateCumulativePayments3(gia_ban) {
            const data = [];
            const tien_coc = 100000000;
            let cumulative = 0;
            
            // Đặt cọc T-30
            data.push({x: -30, y: cumulative});
            cumulative += tien_coc;
            data.push({x: -30, y: cumulative});
            
            // Đợt 1: T
            cumulative += Math.max(0, gia_ban * 0.10 - tien_coc);
            data.push({x: 0, y: cumulative});
            
            // Đợt 2: T+30 (60% - 8% chiết khấu)
            const dot_2_goc = gia_ban * 0.60;
            const chiet_khau = dot_2_goc * 0.08;
            cumulative += (dot_2_goc - chiet_khau);
            data.push({x: 30, y: cumulative});
            
            // Đợt 3: T+720 (Bàn giao)
            cumulative += gia_ban * 0.25;
            cumulative += currentCalculationData.phi_bao_tri_amount; // Phí bảo trì
            data.push({x: 720, y: cumulative});
            
            // Đợt 4: T+750 (GCN)
            cumulative += gia_ban * 0.05;
            data.push({x: 750, y: cumulative});
            
            return data;
        }

        function calculateCumulativePayments4(gia_ban) {
            const data = [];
            const tien_coc = 100000000;
            let cumulative = 0;
            
            // Đặt cọc T-30
            data.push({x: -30, y: cumulative});
            cumulative += tien_coc;
            data.push({x: -30, y: cumulative});
            
            // Đợt 1: T (VTC 8.6%)
            cumulative += Math.max(0, gia_ban * 0.086 - tien_coc);
            data.push({x: 0, y: cumulative});
            
            // T+720 (Bàn giao - Khách 16.4%)
            cumulative += gia_ban * 0.164;
            cumulative += currentCalculationData.phi_bao_tri_amount; // Phí bảo trì
            data.push({x: 720, y: cumulative});
            
            // T+750 (GCN)
            cumulative += gia_ban * 0.05;
            data.push({x: 750, y: cumulative});
            
            return data;
        }

        function openTab(tabName) {
            // Ẩn tất cả tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Bỏ active từ tất cả buttons
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Hiển thị tab được chọn
            document.getElementById(tabName).classList.add('active');
            
            // Đánh dấu button được chọn
            event.target.classList.add('active');
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        function formatCurrencyShort(amount) {
            if (amount >= 1000000000) {
                return (amount / 1000000000).toFixed(1) + ' tỷ';
            } else if (amount >= 1000000) {
                return (amount / 1000000).toFixed(1) + ' tr';
            }
            return formatCurrency(amount);
        }
    </script>
</body>
</html>
